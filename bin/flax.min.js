PTM_RATIO=32;RADIAN_TO_DEGREE=180/Math.PI;DEGREE_TO_RADIAN=Math.PI/180;IMAGE_TYPES=[".png",".jpg",".bmp",".jpeg",".gif"];H_ALIGHS=["left","center","right"];DEFAULT_LANS="en zh de fr it es tr pt ru".split(" ");var TileValue=TileValue||{WALKABLE:0,BLOCK1:1,BLOCK2:2,BLOCK3:3,BLOCK4:4,BLOCK5:5},flax=flax||{};flax.version=1.45;flax.language=null;flax.languageIndex=-1;flax.landscape=!1;flax.osVersion="unknown";flax.assetsManager=null;flax.inputManager=null;flax.currentSceneName="";flax.currentScene=null;
flax.buttonSound=null;flax.frameInterval=1/60;flax._scenesDict={};flax._soundEnabled=!0;flax._inited=!1;flax._orientationTip=null;flax._languageDict=null;flax._languageToLoad=null;flax._addResVersion=function(a){return cc.sys.isNative||-1<a.indexOf("?v\x3d")?a:a+"?v\x3d"+cc.game.config.version};flax._removeResVersion=function(a){if(cc.sys.isNative)return a;var b=a.indexOf("?v\x3d");-1<b&&(a=a.substr(0,b));return a};
flax.isDomainAllowed=function(){if(cc.sys.isNative)return!0;var a=document.domain,b=cc.game.config.domainAllowed;return flax.isLocalDebug()||null==b||0==b.length||-1<b.indexOf(a)};flax.isLocalDebug=function(){if(cc.sys.isNative)return!1;var a=document.domain;return"localhost"==a||0==a.indexOf("192.168.")};
if(!cc.sys.isNative&&(flax.isLocalDebug()&&(cc.game.config.version=1+Math.floor(999998*Math.random())),setTimeout(function(){var a=document.body.style.backgroundColor;document.getElementById(cc.game.config.id).style.backgroundColor=a;a=a.replace("rgb(","");a=a.replace(")","");a=a.split(",");flax.bgColor=cc.color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))},0.01),cc.sys.isMobile)){var __hideBottomBar=function(){document.body.scrollTop=0},orientationEvent="onorientationchange"in window?"orientationchange":
"resize";window.addEventListener(orientationEvent,__hideBottomBar,!0);__hideBottomBar()}
flax.init=function(a,b){if(!flax._inited){flax._inited=!0;cc.log("Flax inited, version: "+flax.version);a||(a=cc.ResolutionPolicy.SHOW_ALL);flax.fetchUserData&&flax.fetchUserData(b);flax._checkOSVersion();var c=cc.game.config.width,d=cc.game.config.height;if(cc.sys.isNative)cc.view.setDesignResolutionSize(c,d,a);else{var e=document.getElementById(cc.game.config.id);e.width=c=c||e.width;e.height=d=d||e.height;cc.view.adjustViewPort(!0);cc.view.setDesignResolutionSize(c,d,a);cc.view.resizeWithBrowserSize(!0)}flax.frameInterval=
1/cc.game.config.frameRate;flax.assetsManager=flax.AssetsManager.create();c=cc.game.config.language;null==c||""==c?null==flax.language&&(c=cc.sys.language,flax.updateLanguage(c)):flax.updateLanguage(c)}};flax.getLanguageStr=function(a){if(null==flax._languageDict)return cc.log("Warning: there is no language defined: "+flax.language),null;var b=flax._languageDict[a];null==b&&cc.log("Warning: there is no language string for key: "+a);return b};
flax.updateLanguage=function(a){null!=a&&""!=a&&a!=flax.language&&(flax.language=a,null!=cc.game.config.languages&&cc.game.config.languages.length||(cc.game.config.languages=DEFAULT_LANS),flax.languageIndex=cc.game.config.languages.indexOf(a),-1==flax.languageIndex?cc.log("Invalid language: "+a):flax._languageToLoad=flax._getLanguagePath(a))};flax._getLanguagePath=function(a){return"res/locale/"+(a||flax.language)+".json"};
flax.addModule=function(a,b,c){for(var d in b)"onEnter"===d?(void 0===a.prototype.__onEnterNum?a.prototype.__onEnterNum=0:a.prototype.__onEnterNum++,a.prototype["__onEnter"+a.prototype.__onEnterNum]=b.onEnter):"onExit"===d?(void 0===a.prototype.__onExitNum?a.prototype.__onExitNum=0:a.prototype.__onExitNum++,a.prototype["__onExit"+a.prototype.__onExitNum]=b.onExit):!0!==c&&a.prototype[d]||(a.prototype[d]=b[d])};
flax.callModuleOnEnter=function(a){if(void 0!==a.__onEnterNum)for(var b=a.__onEnterNum;0<=b;)a["__onEnter"+b](),b--};flax.callModuleOnExit=function(a){if(void 0!==a.__onExitNum)for(var b=a.__onExitNum;0<=b;)a["__onExit"+b](),b--};
flax._checkOSVersion=function(){if(!cc.sys.isNative){var a=navigator.userAgent,b;a.match(/iPad/i)||a.match(/iPhone/i)?(b=a.indexOf("OS "),cc.sys.os=cc.sys.OS_IOS,-1<b&&(flax.osVersion=a.substr(b+3,3).replace("_","."))):a.match(/Android/i)&&(b=a.indexOf("Android "),cc.sys.os=cc.sys.OS_ANDROID,-1<b&&(flax.osVersion=a.substr(b+8,3)))}};flax.registerScene=function(a,b,c){c||(c=[]);c instanceof Array||(c=[c]);flax._scenesDict[a]={scene:b,res:c}};
flax.replaceScene=function(a,b,c){if(flax.isDomainAllowed()){var d=flax._scenesDict[a];if(null==d)throw"Please register the scene: "+a+" firstly!";flax._languageToLoad&&-1==d.res.indexOf(flax._languageToLoad)&&d.res.push(flax._languageToLoad);flax.ObjectPool&&flax.ObjectPool.release();flax.BulletCanvas&&flax.BulletCanvas.reset();flax.Button&&flax.Button.reset();cc.director.resume();flax.currentSceneName=a;flax.stopPhysicsWorld&&flax.stopPhysicsWorld();flax.inputManager&&flax.inputManager.removeFromParent();
flax.preload(d.res,function(){if(flax._languageToLoad){flax._languageDict=cc.loader.getRes(flax._getLanguagePath());var a=d.res.indexOf(flax._languageToLoad);-1<a&&d.res.splice(a,1);flax._languageToLoad=null}flax.currentScene=new d.scene;a=!1;if(b){if(!c||0>c)c=0.5;var f=b.create(c,flax.currentScene);f&&(a=!0,cc.director.runScene(f))}a||cc.director.runScene(flax.currentScene);flax.inputManager=flax.InputManager.create();flax.currentScene.addChild(flax.inputManager,999999);flax._checkDeviceOrientation()})}};
flax._tileMaps={};flax.getTileMap=function(a){if("undefined"!==typeof flax._tileMaps[a])return flax._tileMaps[a];cc.log("The tileMap: "+a+" hasn't been defined, pls use flax.registerTileMap to define it firstly!");return null};flax.registerTileMap=function(a){flax._tileMaps[a.id]=a};flax.setSoundEnabled=function(a){if(flax._soundEnabled!=a){flax._soundEnabled=a;var b=cc.audioEngine;a?(b.resumeMusic(),flax._lastMusic&&(flax.playMusic(flax._lastMusic,!0),flax._lastMusic=null)):(b.pauseMusic(),b.stopAllEffects())}};
flax.getSoundEnabled=function(){return flax._soundEnabled};flax._lastMusic=null;flax.playMusic=function(a,b){var c=cc.audioEngine;c.stopMusic(!1);flax._soundEnabled?c.playMusic(a,b):flax._lastMusic=a};flax.playSound=function(a){flax._soundEnabled&&cc.audioEngine.playEffect(a)};
flax._checkDeviceOrientation=function(){if(!cc.sys.isNative){if(!flax._orientationTip&&cc.sys.isMobile&&cc.game.config.rotateImg){flax._orientationTip=cc.LayerColor.create(flax.bgColor,cc.visibleRect.width+10,cc.visibleRect.height+10);var a=cc.Sprite.create(cc.game.config.rotateImg);a.setPosition(cc.visibleRect.center);flax._orientationTip.__icon=a;flax._orientationTip.addChild(a);window.addEventListener("onorientationchange"in window?"orientationchange":"resize",flax._showOrientaionTip,!0);flax._showOrientaionTip()}flax._orientationTip&&
(flax._orientationTip.removeFromParent(),flax.currentScene.addChild(flax._orientationTip,1E6))}};flax._oldGamePauseState=!1;
flax._showOrientaionTip=function(){flax.landscape=90==Math.abs(window.orientation);flax._orientationTip.visible=cc.game.config.landscape!=flax.landscape;flax._orientationTip.__icon.rotation=flax.landscape?-90:0;document.body.scrollTop=0;flax._orientationTip.visible?(flax._oldGamePauseState=cc.director.isPaused(),cc.director.pause()):flax._oldGamePauseState||cc.director.resume();flax.inputManager.enabled=!flax._orientationTip.visible};
flax.getAngle=function(a,b,c){return flax.getAngle1(b.x-a.x,b.y-a.y,c)};flax.getAngle1=function(a,b,c){void 0===c&&(c=!0);a=Math.atan2(a,b);0>a&&(a+=2*Math.PI);c&&(a*=RADIAN_TO_DEGREE);return a};flax.getPointOnCircle=function(a,b,c){c=(90-c)*DEGREE_TO_RADIAN;null==a&&(a=cc.p());return cc.pAdd(a,cc.p(b*Math.cos(c),b*Math.sin(c)))};flax.getPosition=function(a,b){var c=a.getPosition();!0===b&&a.parent&&(c=a.parent.convertToWorldSpace(c));return c};
flax.getRotation=function(a,b){if(!0!==b)return a.rotation;for(var c=0,d=a;d;)c+=d.rotation,d=d.parent;return c};flax.getScale=function(a,b){if(!0!==b)return cc.p(a.scaleX,a.scaleY);for(var c=1,d=1,e=a;e;)c*=e.scaleX,d*=e.scaleY,e=e.parent;return cc.p(c,d)};
flax.getRect=function(a,b){var c;if(a.getRect)return c=a.getRect(b);if(a instanceof cc.Layer||a instanceof cc.Scene)return cc.rect(0,0,cc.visibleRect.width,cc.visibleRect.height);b=!1!==b;c=a.getPosition();a.parent&&(b?c=a.parent.convertToWorldSpace(c):(c=a.getAnchorPointInPoints(),c=flax.currentScene.convertToNodeSpace(c)));var d=a.getContentSize(),e=a.getAnchorPoint();return c=cc.rect(c.x-d.width*e.x,c.y-d.height*e.y,d.width,d.height)};
flax.ifTouched=function(a,b){if(null==a||!(a instanceof cc.Node))return!1;if(a.mainCollider)return a.mainCollider.containPoint(b);var c=a.convertToNodeSpace(b),d=flax.getRect(a,!1);return cc.rectContainsPoint(d,c)};flax.ifCollide=function(a,b){return a.mainCollider.checkCollision(b.mainCollider)};flax.isChildOf=function(a,b){if(null==a||null==b||a==b)return!1;for(var c=a.parent;c;){if(c==b)return!0;c=c.parent}return!1};
flax.findParentWithClass=function(a,b){for(var c=a;c;){if(c instanceof b)return c;c=c.parent}return null};flax.findChildWithClass=function(a,b){for(var c=a.children,d=c.length,e;d--;)if(e=c[d],e instanceof b||(e=flax.findChildWithClass(e,b)))return e;return null};flax.nameToObject=function(a,b){if(void 0==a||""==a)return null;b=b||"function";for(var c=a.split("."),d=window||this,e=0,f=c.length;e<f;e++)try{d=d[c[e]]}catch(g){break}return typeof d!==b?null:d};
flax.createBGLayer=function(a,b){null==b&&(b=cc.color(255,255,255,255));var c=cc.LayerColor.create(b,cc.visibleRect.width,cc.visibleRect.height);a.addChild(c,0);return c};Array.prototype.shuffle=function(a){if(void 0===a||0>=a||a>this.length)a=this.length;for(a-=1;0<=a;a--){var b=0|cc.rand()%(a+1),c=this[a];this[a]=this[b];this[b]=c}};flax.restrictValue=function(a,b,c){a=Math.max(b,a);return a=Math.min(c,a)};flax.numberSign=function(a){return 0==a?0:0<a?1:-1};
flax.randInt=function(a,b){return a+Math.floor(Math.random()*(b-a))};flax.getRandomInArray=function(a){if(null==a)return null;var b=flax.randInt(0,a.length);return a[b]};flax.isImageFile=function(a){a=cc.path.extname(a);return-1<IMAGE_TYPES.indexOf(a)};flax.copyProperties=function(a,b){if(null!=a&&null!=b)for(var c in a)try{b[c]=a[c]}catch(d){}};flax.createDInts=function(a,b){isNaN(b)&&(b=0);for(var c=[],d=-1,e=b-1,f=b;++d<a;)0==d%2?c.push(++e):c.push(--f);return c};
flax.goHomeUrl=function(){!cc.sys.isNative&&cc.game.config.homeUrl&&window.open(cc.game.config.homeUrl)};function SignalBinding(a,b,c,d,e){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=e||0}
SignalBinding.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;
delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function validateListener(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}function Signal(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){Signal.prototype.dispatch.apply(a,arguments)}}
Signal.prototype={VERSION:"::VERSION_NUMBER::",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,c,d){var e=this._indexOfListener(a,c);if(-1!==e){if(a=this._bindings[e],a.isOnce()!==b)throw Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.");}else a=new SignalBinding(this,a,b,c,d),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},_addBinding:function(a){var b=
this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===b)return c;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){validateListener(a,"add");return this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){validateListener(a,"addOnce");return this._registerListener(a,!0,
b,c)},remove:function(a,b){validateListener(a,"remove");var c=this._indexOfListener(a,b);-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;this.memorize&&(this._prevParams=
b);if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal;(function(a){"function"===typeof define&&define.amd?define(function(){return signals}):"undefined"!==typeof module&&module.exports?module.exports=signals:a.signals=signals})(this);flax=flax||{};flax.drawLine=function(a,b,c,d){flax._createDebugNode();null==c&&(c=1);null==d&&(d=cc.color(255,0,0,255));flax.__drawNode.drawSegment(a,b,c,d)};flax.drawRect=function(a,b,c,d){flax._createDebugNode();null==b&&(b=1);null==c&&(c=cc.color(255,0,0,255));var e=cc.pAdd(cc.p(a.x,a.y),cc.p(a.width,a.height));flax.__drawNode.drawRect(cc.p(a.x,a.y),e,d,b,c)};
flax.drawCircle=function(a,b,c,d){flax._createDebugNode();null==c&&(c=1);null==d&&(d=cc.color(255,0,0,255));flax.__drawNode.drawCircle(a,b,360,360,!1,c,d)};flax.drawDot=function(a,b,c){flax._createDebugNode();null==b&&(b=3);null==c&&(c=cc.color(255,0,0,255));flax.__drawNode.drawDot(a,b,c)};
flax._createDebugNode=function(){null==flax.__drawNode&&(flax.__drawNode=cc.DrawNode.create());flax.currentScene&&(flax.__drawNode.parent&&flax.__drawNode.parent!=flax.currentScene&&(flax.__drawNode.removeFromParent(),flax.__drawNode.clear()),null==flax.__drawNode.parent&&flax.currentScene.addChild(flax.__drawNode,99999))};var flax=flax||{},InputType={press:"onPress",up:"onUp",click:"onClick",move:"onMouseMove"};
flax.InputManager=cc.Node.extend({enabled:!0,inTouching:!1,inDragging:!1,justDragged:!1,justDragDist:0,_masks:[],_callbacks:{},onEnter:function(){this._super();var a=this,b=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(b,d){if(!a.enabled)return!1;a.inDragging=!1;a.justDragged=!1;a.justDragDist=0;a.inTouching=!0;a._dispatchOne(a,b,d,InputType.press);return!0},onTouchEnded:function(b,d){a.inDragging=!1;a.inTouching=!1;a._dispatchOne(a,b,d,InputType.up);
a._dispatchOne(a,b,d,InputType.click)},onTouchMoved:function(b,d){a.inDragging=!0;a.justDragged=!0;a.justDragDist+=cc.pDistance(cc.p(),b.getDelta());a._dispatchOne(a,b,d,InputType.move)}});cc.eventManager.addListener(b,this)},onExit:function(){this._super();this._masks=[];this.inTouching=!1;this._callbacks={};cc.eventManager.removeAllListeners()},addMask:function(a){-1<this._masks.indexOf(a)||this._masks.push(a)},removeMask:function(a){a=this._masks.indexOf(a);-1<a&&this._masks.splice(a,1)},_compareRealZIndex:function(a,
b){if(!a.parent||!b.parent)return 1;if(a.parent==b.parent)return this._childIsOnFront(a,b);for(var c=null,d=0,e=[],f=a.parent;f;)e.push(f),f=f.parent;for(var g=[],f=b.parent;f;){d=e.indexOf(f);if(-1<d){c=f;break}g.push(f);f=f.parent}e=e.slice(0,d);return this._childIsOnFront(e[e.length-1]||a,g[g.length-1]||b,c)?1:-1},_childIsOnFront:function(a,b,c){null==c&&(c=a.parent);return c.children.indexOf(a)>c.children.indexOf(b)},addListener:function(a,b,c,d){if(null==b)throw"Event callback can not be null!";
null==a&&(cc.log("target is null, make sure you want to listen to the full screen input!"),a=this);c=null==c?InputType.click:c;null==a.__instanceId&&(a.__instanceId=ClassManager.getNewInstanceId());var e=this._callbacks[a.__instanceId];null==e&&(e=[],this._callbacks[a.__instanceId]=e,a!=this&&this._createListener(a,!0));for(var f=e.length;f--;)if(e[f].type==c&&e[f].func==b)return;e.push({type:c,func:b,context:d||a})},removeListener:function(a,b,c){null==a&&(a=this);var d=this._callbacks[a.__instanceId];
d&&this.scheduleOnce(function(){var e=null,f=d.length;if(b||c)for(;f--;)e=d[f],(c&&e.type==c||b&&e.func==b)&&d.splice(f,1);0!=d.length&&(b||c)||delete this._callbacks[a.__instanceId]},0.01)},handleTouchBegan:function(a,b){if(!this.enabled)return!1;var c=b.getCurrentTarget();if(this._ifTargetIgnore(c,a))return!1;var d=a.getLocation();if(!this._ifNotMasked(c,d))return!1;b.currentTarget=c;b.target=this._findRealTarget(c,d)||c;if((c instanceof cc.Layer||c instanceof flax.MovieClip)&&b.target==c)return!1;
this._dispatch(c,a,b,InputType.press);return!0},handleTouchEnded:function(a,b){var c=b.getCurrentTarget();b.currentTarget=c;b.target=this._findRealTarget(c,a.getLocation())||c;this._dispatch(c,a,b,InputType.up);flax.ifTouched(c,a.getLocation())&&this._dispatch(c,a,b,InputType.click)},handleTouchMoved:function(a,b){var c=b.getCurrentTarget();this._dispatch(c,a,b,InputType.move)},_createListener:function(a,b){var c=this,d=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:b,
onTouchBegan:function(a,b){return c.handleTouchBegan(a,b)},onTouchEnded:function(a,b){c.handleTouchEnded(a,b)},onTouchMoved:function(a,b){c.handleTouchMoved(a,b)},onTouchCancelled:function(a,b){c.handleTouchEnded(a,b)}});cc.eventManager.addListener(d,a)},_ifNotMasked:function(a,b){for(var c=this._masks.length,d=null,d=null;c--;)if(d=this._masks[c],a!=d&&!flax.isChildOf(a,d)&&!flax.isChildOf(d,a)&&!this._ifTargetIgnore(d)&&1==this._compareRealZIndex(d,a)&&(d=this._findRealTarget(d,b)))return!1;return!0},
_findRealTarget:function(a,b){a instanceof Array||(a=[a]);for(var c=null,d=a.length;d--;)if(c=a[d],!this._ifTargetIgnore(c)){if(0<c.children.length&&(this._temp=this._findRealTarget(c.children,b)))return this._temp;if(flax.ifTouched(c,b))return c}return null},_ifTargetIgnore:function(a,b){return null==a||!a.running||!this._ifTargetVisible(a)||a.isMouseEnabled&&!1===a.isMouseEnabled()||b&&!flax.ifTouched(a,b.getLocation())?!0:!1},_ifTargetVisible:function(a){for(;a;){if(!a.visible)return!1;a=a.parent}return!0},
_dispatch:function(a,b,c,d){for(var e=[];a;)e.push(a),a=a.parent;for(var f=0;f<e.length;f++)a=e[f],this._dispatchOne(a,b,c,d)},_dispatchOne:function(a,b,c,d){var e=this._callbacks[a.__instanceId];if(e&&e.length){c.currentTarget=a;a=null;for(var f=[],g=e.length;g--;)a=e[g],a.type==d&&f.push(a);for(g=f.length;g--;)a=f[g],a.func.apply(a.context,[b,c])}}});flax.InputManager.create=function(){return new flax.InputManager};flax=flax||{};F2C_ALIAS={mc:"flax.MovieClip",btn:"flax.SimpleButton",button:"flax.Button",progress:"flax.ProgressBar",scrollPane:"flax.ScrollPane",scrollPane1:"flax.ScrollPane1",gun:"flax.Gunner",gun1:"flax.MCGunner"};
flax.AssetsManager=cc.Class.extend({framesCache:null,displaysCache:null,displayDefineCache:null,mcsCache:null,subAnimsCache:null,fontsCache:null,init:function(){this.framesCache={};this.displaysCache={};this.displayDefineCache={};this.mcsCache={};this.subAnimsCache={};this.fontsCache={}},createDisplay:function(a,b,c,d,e){if(null==a||null==b)throw"Pleas give me assetsFile and assetID!";if(c&&"string"===typeof c||e&&"string"!==typeof e)throw"Params error: maybe you are using the old api, please use the latest!";
this.addAssets(a);var f=!1;e?f=!0:e=b;var g=this.getSubAnims(a,b);g.length&&(b=b+"$"+g[0]);g=flax.nameToObject(e);if(null==g&&f)throw"The class: "+e+" doesn't exist!";if(null==g&&!f)if(e=this.getDisplayDefine(a,b),f=!1,null==e&&(e=this.getMc(a,b),f=!0),e)e=e.type,g=flax.nameToObject(e),null==g&&(e=F2C_ALIAS[e],g=flax.nameToObject(e)),null==g&&(g=f?flax.MovieClip:flax.Animator,e=f?"flax.MovieClip":"flax.Animator");else throw"There is no display with assetID: "+b+" in assets file: "+a;null==c&&(c={});
var f=null,h=c.parent;delete c.parent;!0===d?f=flax.ObjectPool.get(a,e,b).fetch(b,h,c):(f=g.create?g.create(a,b):new g(a,b),f.attr(c),h&&h.addChild(f),f.clsName=e);return f},cloneDisplay:function(a,b,c){if(!(a instanceof flax.FlaxSprite))throw"cloneDisplay only support flax.FlaxSprite type!";b=this.createDisplay(a.assetsFile,a.assetID,{parent:c?a.parent:null},b,a.clsName);c&&b.setPosition(a.getPosition());b.setScale(a.getScale());b.setRotation(a.rotation);b.zIndex=a.zIndex;return b},addAssets:function(a){if("undefined"!==
typeof this.framesCache[a])return!1;var b=a;".flax"==cc.path.extname(a)&&(b=cc.path.changeBasename(b,".plist"));var c=cc.loader.getRes(b);if(null==c)throw"Make sure you have pre-loaded the resource: "+a;if(!c.metadata.flaxVersion||1.45>c.metadata.flaxVersion)throw"Please use the Flax tool of version 1.45 or later!";cc.spriteFrameCache.addSpriteFrames(b);cc.loader.cache[b]="loaded!";var b=[],d=c.frames,e;for(e in d)b.push(e);b.sort();this.framesCache[a]=b;c.displays&&this._parseDisplays(a,c.displays);
c.mcs&&this._parseMovieClips(a,c.mcs);c.fonts&&this._parseFonts(a,c.fonts);return!0},_parseDisplays:function(a,b){var c=[],d=null,e;for(e in b)c.push(e),d=b[e],d.anchors&&(d.anchors=this._parseFrames(d.anchors)),d.colliders&&(d.colliders=this._parseFrames(d.colliders)),this.displayDefineCache[a+e]=d,this._parseSubAnims(a,e);this.displaysCache[a]=c},_parseMovieClips:function(a,b){for(var c in b){var d=b[c];d.anchors&&(d.anchors=this._parseFrames(d.anchors));d.colliders&&(d.colliders=this._parseFrames(d.colliders));
var e,f=d.children,g;for(g in f)e=f[g],e.frames=this._strToArray(e.frames);this.mcsCache[a+c]=d;this._parseSubAnims(a,c)}},_parseFonts:function(a,b){for(var c in b)this.fontsCache[a+c]=b[c]},_parseSubAnims:function(a,b){var c=b.split("$"),d=c[0],c=c[1];if(d&&c&&""!=d&&""!=c){var d=a+d,e=this.subAnimsCache[d];null==e&&(e=[],this.subAnimsCache[d]=e);e.push(c)}},_parseFrames:function(a){var b={},c;for(c in a)b[c]=this._strToArray(a[c]);return b},_strToArray:function(a){a=a.split("|");for(var b=-1,c=
[];++b<a.length;){var d=a[b];"null"===d?c.push(null):""===d?c.push(c[b-1]):c.push(d)}return c},getFrameNames:function(a,b,c){this.addAssets(a);a=this.framesCache[a];if(null==a)return[];-1==b&&(b=0);-1==c&&(c=a.length-1);return a.slice(parseInt(b),parseInt(c)+1)},getFrameNamesOfDisplay:function(a,b){var c=this.getDisplayDefine(a,b);if(null==c)throw"There is no display named: "+b+" in assetsFile: "+a;return this.getFrameNames(a,c.start,c.end)},getDisplayDefine:function(a,b){this.addAssets(a);return this.displayDefineCache[a+
b]},getDisplayNames:function(a){this.addAssets(a);return this.displaysCache[a]||[]},getRandomDisplayName:function(a){a=this.getDisplayNames(a);var b=Math.floor(Math.random()*a.length);return a[b]},getMc:function(a,b){this.addAssets(a);return this.mcsCache[a+b]},getSubAnims:function(a,b){this.addAssets(a);return this.subAnimsCache[a+b]||[]},getFont:function(a,b){this.addAssets(a);return this.fontsCache[a+b]}});flax.AssetsManager.create=function(){var a=new flax.AssetsManager;a.init();return a};
flax._flaxLoader={load:function(a,b,c,d){cc.loader.loadBinary(a,function(b,c){a=flax._removeResVersion(a);for(var g=(new Zlib.RawInflate(c)).decompress(),h="",k=g.length,m=0;m<k;m++)h+=String.fromCharCode(g[m]);c=h.split("data:image/gif;base64,");h=cc.path.changeBasename(a,".plist");g=cc.path.changeBasename(a,".png");cc.loader.cache[h]=JSON.parse(c[0]);h=new Image;h.src="data:image/gif;base64,"+c[1];cc.loader.cache[g]=h;cc.textureCache.handleLoadedTexture(g);flax.assetsManager.addAssets(a);b?d(b):
d(null,"Not reachable!");cc.loader.release(a);cc.loader.cache[a]="loaded!"})}};cc.sys.isNative||cc.loader.register(["flax"],flax._flaxLoader);flax=flax||{};flax.ColliderType={rect:"Rect",circle:"Circle",polygon:"Poly"};
flax.Collider=cc.Class.extend({name:null,owner:null,type:flax.ColliderType.rect,physicsBody:null,physicsFixture:null,physicsContact:null,_center:null,_width:0,_height:0,_rotation:0,_localRect:null,_polygons:null,ctor:function(a,b){a=a.split(",");this.type=a[0];this._center=cc.p(parseFloat(a[1]),parseFloat(a[2]));this._width=parseFloat(a[3]);this._height=parseFloat(a[4]);this._rotation=parseFloat(a[5]);if(6<a.length){this._polygons=[];for(var c=a[6].split("'"),d=0;d<c.length-1;d+=2){var e=cc.p(parseFloat(c[d]),
parseFloat(c[d+1]));this._polygons.push(e)}}!1===b&&(this._center.x+=this._width/2,this._center.y+=this._height/2);this._localRect=cc.rect(this._center.x-this._width/2,this._center.y-this._height/2,this._width,this._height)},createPhysics:function(a,b,c,d,e,f){if(this.physicsFixture)return this.physicsFixture;var g=this.physicsBody=this.owner.physicsBody;if(null==g)throw"Please CreatePhysics in its owner firstly!";var h=this.getSize(),k=this.getCenter(),m=flax.getPosition(this.owner,!0),l=null;if(this.type==
flax.ColliderType.circle)l=new Box2D.Collision.Shapes.b2CircleShape,l.SetRadius(0.5*h.width*flax.getScale(this.owner,!0).x/PTM_RATIO),m=cc.pSub(k,m),l.SetLocalPosition(cc.pMult(m,1/PTM_RATIO));else if(this.type==flax.ColliderType.rect||this.type==flax.ColliderType.polygon){if(this.type==flax.ColliderType.rect)for(this._polygons=[cc.p(-0.5*h.width,-0.5*h.height),cc.p(0.5*h.width,-0.5*h.height),cc.p(0.5*h.width,0.5*h.height),cc.p(-0.5*h.width,0.5*h.height)],h=0;h<this._polygons.length;h++)k=this._polygons[h],
k.x+=this._center.x,k.y+=this._center.y;for(var l=new Box2D.Collision.Shapes.b2PolygonShape,n=[],h=0;h<this._polygons.length;h++)k=cc.p(this._polygons[h]),k=this.owner.convertToWorldSpace(k),k.x-=m.x,k.y-=m.y,k.x/=PTM_RATIO,k.y/=PTM_RATIO,n.push(k);l.SetAsArray(n)}else throw"The physics type: "+this.type+" is not supported!";m=new Box2D.Dynamics.b2FixtureDef;m.shape=l;null==a&&(a=0);m.density=a;null==b&&(b=0.2);m.friction=b;null==c&&(c=0);m.restitution=c;m.isSensor=d;null==e&&(e=1);null==f&&(f=65535);
m.filter.categoryBits=e;m.filter.maskBits=f;this.physicsFixture=g.CreateFixture(m);this.physicsFixture.SetUserData(this);return this.physicsFixture},destroyPhysics:function(){this.physicsFixture&&(flax.removePhysicsFixture(this.physicsFixture),this.physicsBody=this.physicsFixture=null)},checkCollision:function(a){if(a.type==this.type&&this.type==flax.ColliderType.rect)return cc.rectIntersectsRect(this.getRect(!0),a.getRect(!0));if(a.type==this.type&&this.type==flax.ColliderType.circle){var b=this.getCenter(!0),
c=a.getCenter(!0);return cc.pDistance(b,c)<=(this.getSize().width+a.getSize().width)/2}if(this.type==flax.ColliderType.rect)return this._ifRectCollidCircle(this.getRect(!0),a.getRect(!0));if(this.type==flax.ColliderType.circle)return this._ifRectCollidCircle(a.getRect(!0),this.getRect(!0))},containPoint:function(a){a=this.owner.convertToNodeSpace(a);return this.type==flax.ColliderType.rect?cc.rectContainsPoint(this._localRect,a):cc.pDistance(a,this._center)<=this._width/2},_ifRectCollidCircle:function(a,
b){var c=Math.abs(b.x+b.width/2-(a.x+a.width/2)),d=Math.abs(b.y+b.height/2-(a.y+a.height/2));if(c>a.width/2+b.width/2||d>a.height/2+b.width/2)return!1;if(c<=a.width/2||d<=a.height/2)return!0;c-=a.width/2;d-=a.height/2;return c*c+d*d<=b.width/2*b.width/2},getRect:function(a){if(!1===a)return this._localRect;a=this.getCenter(!0);var b=this.getSize();return cc.rect(a.x-b.width/2,a.y-b.height/2,b.width,b.height)},getCenter:function(a){var b=this.owner.convertToWorldSpace(this._center);!1===a&&this.owner.parent&&
(b=this.owner.parent.convertToNodeSpace(b));return b},getSize:function(){var a=flax.getScale(this.owner,!0),b=this._width*Math.abs(a.x),a=this._height*Math.abs(a.y);return{width:b,height:a}},debugDraw:function(){var a=this.getRect(!0);if(this.type==flax.ColliderType.rect)flax.drawRect(a);else{var b=cc.DrawNode.create();flax.currentScene&&flax.currentScene.addChild(b,99999);var c=cc.color(255,0,0,255),d=cc.color(0,255,0,122);if(this.type==flax.ColliderType.circle)b.drawCircle(this.getCenter(!0),a.width/
2,0,360,!1,1,c,d);else{for(var e=a=null,f=null,g=0;g<this._polygons.length-1;g++)e=cc.p(this._polygons[g]),e=this.owner.convertToWorldSpace(e),0==g&&(a=cc.p(e)),f=cc.p(this._polygons[g+1]),f=this.owner.convertToWorldSpace(f),b.drawSegment(e,f,1,c,d);b.drawSegment(f,a,1,c,d)}}}});flax.onCollideStart=new signals.Signal;flax.onCollideEnd=new signals.Signal;flax.onCollidePre=new signals.Signal;flax.onCollidePost=new signals.Signal;flax._physicsWorld=null;flax._physicsListener=null;
flax._physicsRunning=!1;flax._physicsBodyToRemove=null;flax._physicsFixtureToRemove=null;flax.physicsTypeStatic=0;flax.physicsTypeKinematic=1;flax.physicsTypeDynamic=2;flax.createPhysicsWorld=function(a,b){flax._physicsWorld&&flax.destroyPhysicsWorld();var c=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(a.x,a.y),!0===b);c.SetContinuousPhysics(!0);flax._physicsWorld=c;flax._physicsBodyToRemove=[];flax._physicsFixtureToRemove=[];return c};
flax.getPhysicsWorld=function(){if(null==flax._physicsWorld)throw"Pleas use flax.createPhysicsWorld to create the world firstly!";return flax._physicsWorld};flax.startPhysicsWorld=function(){flax.getPhysicsWorld()&&flax.currentScene&&!flax._physicsRunning&&(flax._createPhysicsListener(),flax.currentScene.schedule(flax._updatePhysicsWorld,1/cc.game.config.frameRate),flax._physicsRunning=!0)};
flax.stopPhysicsWorld=function(){flax._physicsRunning&&flax.currentScene&&(flax.currentScene.unschedule(flax._updatePhysicsWorld),flax._physicsRunning=!1)};
flax.destroyPhysicsWorld=function(){if(flax._physicsWorld){flax.stopPhysicsWorld();for(var a=flax._physicsWorld.GetBodyList();a;a=a.GetNext()){var b=a.GetUserData();b&&(b._physicsBody=null);flax._physicsWorld.DestroyBody(a)}flax.onCollideStart.removeAll();flax.onCollideEnd.removeAll();flax.onCollidePre.removeAll();flax.onCollidePost.removeAll();flax._physicsWorld=null;flax._physicsListener=null;flax._physicsBodyToRemove=null}};
flax.removePhysicsBody=function(a){-1==flax._physicsBodyToRemove.indexOf(a)&&flax._physicsBodyToRemove.push(a)};flax.removePhysicsFixture=function(a){-1==flax._physicsFixtureToRemove.indexOf(a)&&flax._physicsFixtureToRemove.push(a)};
flax.physicsRaycast=function(a,b,c,d){flax.getPhysicsWorld().RayCast(function(e,f,g,h){e=e.GetUserData();f=cc.pMult(f,PTM_RATIO);var k=cc.pSub(c,f);g=cc.pMult(g,cc.pDot(k,g));k=cc.pSub(c,cc.pMult(g,2));g=flax.getAngle(f,k);d&&0<d&&(h=flax.getAngle(b,c),d/=Math.sin(Math.abs(g/2-h/2)*Math.PI/180),f=cc.pSub(f,flax.getPointOnCircle(cc.p(),d,h)),k=cc.pDistance(b,c),h=cc.pDistance(b,f)/k,k=flax.getPointOnCircle(f,k*(1-h),g));a(e,f,k,h)},cc.pMult(b,1/PTM_RATIO),cc.pMult(c,1/PTM_RATIO))};
flax.physicsSimulate=function(a,b,c){c||(c=flax.frameInterval);b=Math.round(b/c);for(var d=a.GetPosition(),e=a.GetAngle(),f={},g=0,h=flax._physicsWorld.GetBodyList();h;h=h.GetNext())if(h!=a){var k=h.GetType();k!=flax.physicsTypeStatic&&(h.m_type=flax.physicsTypeStatic,h.__tempKey=++g,f[h.__tempKey]=k)}k=[];for(g=0;g<b;g++)flax._physicsWorld.Step(c,velocityIterations,positionIterations),h=a.GetPosition(),k.push(cc.p(h.x*PTM_RATIO,h.y*PTM_RATIO));for(h=flax._physicsWorld.GetBodyList();h;h=h.GetNext())h.__tempKey&&
(h.SetType(f[h.__tempKey]),delete h.__tempKey);a.SetPositionAndAngle(d,e);return k};
flax._createPhysicsListener=function(){flax._physicsListener||(flax._physicsListener=new Box2D.Dynamics.b2ContactListener,flax._physicsListener.BeginContact=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetUserData()||b,c=c.GetUserData()||c;b.owner&&null==b.owner.parent||c.owner&&null==c.owner.parent||(b.physicsContact=c.physicsContact=a,flax.onCollideStart.dispatch(b,c),b.physicsContact=c.physicsContact=null)},flax._physicsListener.EndContact=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),
b=b.GetUserData()||b,c=c.GetUserData()||c;b.owner&&null==b.owner.parent||c.owner&&null==c.owner.parent||(b.physicsContact=c.physicsContact=a,flax.onCollideEnd.dispatch(b,c),b.physicsContact=c.physicsContact=null)},flax._physicsListener.PreSolve=function(a,b){var c=a.GetFixtureA(),d=a.GetFixtureB(),c=c.GetUserData()||c,d=d.GetUserData()||d;c.owner&&null==c.owner.parent||d.owner&&null==d.owner.parent||(c.physicsContact=d.physicsContact=a,flax.onCollidePre.dispatch(c,d),c.physicsContact=d.physicsContact=
null)},flax._physicsListener.PostSolve=function(a,b){var c=a.GetFixtureA(),d=a.GetFixtureB(),c=c.GetUserData()||c,d=d.GetUserData()||d;c.owner&&null==c.owner.parent||d.owner&&null==d.owner.parent||(c.physicsContact=d.physicsContact=a,flax.onCollidePost.dispatch(c,d),c.physicsContact=d.physicsContact=null)},flax._physicsWorld.SetContactListener(flax._physicsListener))};
flax.createPhysicalWalls=function(a,b){if(null==a||0==a.length)a=[1,1,1,1];var c=flax.getPhysicsWorld(),d=new Box2D.Dynamics.b2FixtureDef;d.density=1;null==b&&(b=3);d.friction=b;var e=new Box2D.Dynamics.b2BodyDef,f=cc.director.getWinSize();e.type=Box2D.Dynamics.b2Body.b2_staticBody;d.shape=new Box2D.Collision.Shapes.b2PolygonShape;d.shape.SetAsBox(0.5*f.width/PTM_RATIO,0.5);a[0]&&(e.position.Set(0.5*f.width/PTM_RATIO,f.height/PTM_RATIO),c.CreateBody(e).CreateFixture(d));a[1]&&(e.position.Set(0.5*
f.width/PTM_RATIO,0),c.CreateBody(e).CreateFixture(d));d.shape.SetAsBox(0.5,0.5*f.height/PTM_RATIO);a[2]&&(e.position.Set(0,0.5*f.height/PTM_RATIO),c.CreateBody(e).CreateFixture(d));a[3]&&(e.position.Set(f.width/PTM_RATIO,0.5*f.height/PTM_RATIO),c.CreateBody(e).CreateFixture(d))};var velocityIterations=8,positionIterations=1;
flax._updatePhysicsWorld=function(a){for(var b=flax._physicsFixtureToRemove.length;b--;){var c=flax._physicsFixtureToRemove[b],d=c.GetBody();d&&d.DestroyFixture(c);flax._physicsFixtureToRemove.splice(b,1)}for(b=flax._physicsBodyToRemove.length;b--;)flax._physicsWorld.DestroyBody(flax._physicsBodyToRemove[b]),flax._physicsBodyToRemove.splice(b,1);flax._physicsWorld.Step(a,velocityIterations,positionIterations);for(a=flax._physicsWorld.GetBodyList();a;a=a.GetNext())b=a.GetUserData(),null!=b&&null!=
b&&b.parent&&(c=cc.p(a.GetPosition()),c.x*=PTM_RATIO,c.y*=PTM_RATIO,c=b.parent.convertToNodeSpace(c),b.x=c.x,b.y=c.y,b.rotation=-1*RADIAN_TO_DEGREE*a.GetAngle(),b.rotation+=a.__rotationOffset)};flax._debugBox2DNode=null;flax.debugDrawPhysics=function(){null==flax._debugBox2DNode&&(flax._debugBox2DNode=new flax.DebugBox2DNode(flax.getPhysicsWorld()),flax.currentScene.addChild(flax._debugBox2DNode,Number.MAX_VALUE))};
flax.DebugBox2DNode=cc.Node.extend({_refWorld:null,ctor:function(a){this._super();this._refWorld=a;a=Box2D.Dynamics.b2DebugDraw;var b=new a;b.SetSprite(document.getElementById("gameCanvas").getContext("2d"));var c=PTM_RATIO*cc.view.getViewPortRect().width/cc.view.getDesignResolutionSize().width;b.SetDrawScale(c);b.SetFillAlpha(0.5);b.SetLineThickness(1);b.SetFlags(a.e_shapeBit|a.e_jointBit|a.e_centerOfMassBit);this._refWorld.SetDebugDraw(b)},draw:function(a){this._super();this._refWorld&&(a.scale(1,
-1),this._refWorld.DrawDebugData(),a.scale(1,1),a.translate(0,0))}});flax=flax||{};flax.Anchor=cc.Class.extend({x:0,y:0,zIndex:0,rotation:0,ctor:function(a){a=a.split(",");this.x=parseFloat(a[0]);this.y=parseFloat(a[1]);2<a.length&&(this.zIndex=parseInt(a[2]));3<a.length&&(this.rotation=parseFloat(a[3]))}});
flax.FlaxSprite=cc.Sprite.extend({__instanceId:null,onAnimationOver:null,autoDestroyWhenOver:!1,autoStopWhenOver:!1,autoHideWhenOver:!1,autoRecycle:!1,assetsFile:null,currentFrame:0,currentAnim:null,prevFrame:-1,totalFrames:0,frameInterval:0,loopStart:0,loopEnd:0,define:null,name:null,assetID:null,clsName:"flax.FlaxSprite",__isFlaxSprite:!0,_fps:30,playing:!1,inRecycle:!1,_colliders:null,_mainCollider:null,_physicsBody:null,_definedMainCollider:!1,_anchorBindings:null,_inited:!1,tx:0,ty:0,autoUpdateTileWhenMove:!0,
tileValue:TileValue.WALKABLE,_tileMap:null,_tileInited:!1,_mouseEnabled:!0,_baseAssetID:null,_currentSubAnim:null,_subAnims:null,_animSequence:null,_loopSequence:!1,_sequenceIndex:0,_physicsToBeSet:null,_physicsBodyParam:null,_physicsColliders:null,ctor:function(a,b){if("flax.FlaxSprite"==this.clsName)throw"flax.FlaxSprite is an abstract class, please use flax.Animator or flax.MovieClip!";cc.Sprite.prototype.ctor.call(this);if(!a||!b)throw"Please set assetsFile and assetID to me!";this.__instanceId=
ClassManager.getNewInstanceId();this._anchorBindings=[];this._animSequence=[];this.onAnimationOver=new signals.Signal;this.setSource(a,b)},setSource:function(a,b){if(null==a||null==b)throw"assetsFile and assetID can not be null!";if(this.assetsFile!=a||this.assetID!=b&&this._baseAssetID!=b){this.assetsFile=a;flax.assetsManager.addAssets(a);var c=b.split("$");this._baseAssetID=c[0];this._subAnims=flax.assetsManager.getSubAnims(a,this._baseAssetID);c=c[1];null==c&&this._subAnims&&(c=this._subAnims[0]);
b=this._baseAssetID;c&&(b=this._baseAssetID+"$"+c,this._currentSubAnim=c);this.assetID=b;this.define=this.getDefine();var c=this.define.anchorX,d=this.define.anchorY;isNaN(c)||isNaN(d)||this.setAnchorPoint(c,d);this.onNewSource();this.currentFrame=0;this.renderFrame(this.currentFrame,!0);this._initColliders();this.parent&&this._updateLaguage();null==this.__pool__id__&&(this.__pool__id__=this.assetID)}},getLabels:function(a){return this.define.labels?this.define.labels[a]:null},hasLabel:function(a){return null!=
this.getLabels(a)},getMainCollider:function(){return this._mainCollider},getPhysicsBody:function(){return this._physicsBody},getCollider:function(a){var b=null;if(this._colliders){var c=this._colliders[a];null!=c&&(b=c[this.currentFrame])}null==b&&cc.log("Warning: The collider: "+a+" can't be found at "+this.assetID+"of"+this.assetsFile+", make sure you are a pro user!");return b},createPhysics:function(a,b,c){null==a&&(a=Box2D.Dynamics.b2Body.b2_dynamicBody);this._physicsBodyParam={type:a,fixedRotation:b,
bullet:c};if(!this.parent)return null;if(null==this._physicsBody){var d=new Box2D.Dynamics.b2BodyDef;d.type=a;d.fixedRotation=b;d.bullet=c;d.userData=this;a=flax.getPosition(this,!0);d.position.Set(a.x/PTM_RATIO,a.y/PTM_RATIO);this._physicsBody=flax.getPhysicsWorld().CreateBody(d);this._physicsBody.__rotationOffset=this.rotation}return this._physicsBody},destroyPhysics:function(){this.removePhysicsShape()},addPhysicsShape:function(a,b,c,d,e,f,g){if(null==this._physicsBody)throw"Please createPhysics firstly!";
var h=this.getCollider(a);if(null==h)return cc.log("There is no collider named: "+a),null;if(h.physicsFixture)return h.physicsFixture;var k={density:b,friction:c,restitution:d,isSensor:e,catBits:f,maskBits:g};if(this.parent)return a=h.createPhysics(b,c,d,e,f,g),-1==this._physicsColliders.indexOf(h)&&this._physicsColliders.push(h),a;null==this._physicsToBeSet&&(this._physicsToBeSet={});null==this._physicsToBeSet[a]&&(this._physicsToBeSet[a]=k);return null},removePhysicsShape:function(a){for(var b=
this._physicsColliders.length;b--;){var c=this._physicsColliders[b];if(null==a||c.name==a)c.destroyPhysics(),this._physicsColliders.splice(b,1)}0==this._physicsColliders.length&&(flax.removePhysicsBody(this._physicsBody),this._physicsBody=null)},_initColliders:function(){this._mainCollider=null;this._colliders={};var a=this.define.colliders;if(a){var b=null,c;for(c in a){this._colliders[c]=[];for(var d=a[c],e=-1;++e<d.length;)if(null==d[e])this._colliders[c][e]=null;else if(b=this._colliders[c][e]=
new flax.Collider(d[e]),b.name=c,b.owner=this,"main"==c||"base"==c)this._mainCollider=b}}this._definedMainCollider=null!=this._mainCollider;this._definedMainCollider||(this._mainCollider=new flax.Collider("Rect,0,0,"+this.width+","+this.height+",0",!1),this._mainCollider.name="main",this._mainCollider.owner=this);this._physicsColliders=[]},getRect:function(a){return this._mainCollider.getRect(a)},getCenter:function(a){return this._mainCollider.getCenter(a)},getAnchor:function(a){return this.define.anchors&&
(a=this.define.anchors[a],null!=a)?new flax.Anchor(a[this.currentFrame]):null},bindAnchor:function(a,b,c){if(!this.define.anchors)return cc.log(this.assetID+": there is no any anchor!"),!1;if(null==this.define.anchors[a])return cc.log(this.assetID+": there is no anchor named "+a),!1;if(null==b)throw"Node can't be null!";if(-1<this._anchorBindings.indexOf(b))return cc.log(this.assetID+": anchor has been bound, "+a),!1;!1!==c&&this._anchorBindings.push(b);b.__anchor__=a;this._updateAnchorNode(b,this.getAnchor(a));
b.parent!=this&&(b.removeFromParent(!1),this.addChild(b));return!0},getCurrentLabel:function(){if(!this.define.labels)return null;var a=this.define.labels,b=null,c;for(c in a)if(b=a[c],this.currentFrame>=b.start&&this.currentFrame<=b.end)return c;return null},play:function(){this.loopStart=0;this.loopEnd=this.totalFrames-1;this.updatePlaying(!0);this.currentAnim=null},playSequence:function(a){if(null==a)return!1;a instanceof Array||(a=Array.prototype.slice.call(arguments));if(0==a.length)return!1;
this._loopSequence=!1;this._sequenceIndex=0;var b=this.gotoAndPlay(a[0]);this._animSequence=a;return b},playSequenceLoop:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));this.playSequence(a);this._loopSequence=!0},setSubAnim:function(a,b){if(!a||0==a.length||null==this._subAnims||-1==this._subAnims.indexOf(a))return!1;this._currentSubAnim=a;this.setSource(this.assetsFile,this._baseAssetID+"$"+a);!1===b?this.gotoAndStop(0):this.gotoAndPlay(0);this._animTime=0;return!0},gotoAndPlay:function(a){if("string"===
typeof a){if(this.playing&&this.currentAnim==a)return!0;var b=this.getLabels(a);if(null==b){if(this.setSubAnim(a,!0))return!0;this.play();return!1}this.loopStart=b.start;this.loopEnd=b.end;this.currentFrame=this.loopStart;this.currentAnim=a}else{if(!this.isValideFrame(a))return cc.log("The frame: "+a+" is out of range!"),!1;this.loopStart=0;this.loopEnd=this.totalFrames-1;this.currentFrame=a;this.currentAnim=null}this.renderFrame(this.currentFrame);this.updatePlaying(!0);this._animTime=0;return!0},
stop:function(){this.updatePlaying(!1);this.currentAnim=null},gotoAndStop:function(a){if(isNaN(a)){var b=this.getLabels(a);if(null==b)return this.setSubAnim(a,!1);a=b.start}this.currentAnim=null;if(!this.isValideFrame(a))return cc.log("The frame: "+a+" is out of range!"),!1;this.updatePlaying(!1);this.currentFrame=a;this.renderFrame(a);return!0},setFPS:function(a){this._fps!=a&&(this._fps=a,this.updateSchedule())},getFPS:function(){return this._fps},updatePlaying:function(a){this.playing!=a&&(this.playing=
a,this.updateSchedule())},updateSchedule:function(){this.playing?1<this.totalFrames&&this.schedule(this.onFrame,1/this._fps,cc.REPEAT_FOREVER,0):this.unschedule(this.onFrame)},_animTime:0,onFrame:function(a){this.visible&&!this.inRecycle&&(this.renderFrame(this.currentFrame),this.currentFrame++,this._animTime+=a,this.currentFrame>this.loopEnd&&(this.onAnimationOver.getNumListeners()&&this.onAnimationOver.dispatch(this),this.autoDestroyWhenOver?(this.updatePlaying(!1),this.destroy()):this.autoStopWhenOver?
(this.currentFrame=this.loopEnd,this.updatePlaying(!1)):this.autoHideWhenOver?(this.currentFrame=this.loopEnd,this.updatePlaying(!1),this.visible=!1):this._animSequence.length?this._playNext():this.currentFrame=this.loopStart,this._animTime=0))},_playNext:function(){this._sequenceIndex++;if(this._sequenceIndex>=this._animSequence.length){if(!this._loopSequence){this._animSequence=[];return}this._sequenceIndex=0}var a=this._animSequence,b=a[this._sequenceIndex];if("number"===typeof b)if(this._loopSequence&&
this._sequenceIndex==a.length-1?this._sequenceIndex=0:this._sequenceIndex++,a.length>this._sequenceIndex&&"string"===typeof a[this._sequenceIndex]){var c=b,b=a[this._sequenceIndex];this.scheduleOnce(function(){this.gotoAndPlay(b)},c-this._animTime);this.updatePlaying(!1)}else this._animSequence=[],this.currentFrame=this.loopStart;else this.gotoAndPlay(b)},isValideFrame:function(a){return 0<=a&&a<this.totalFrames},renderFrame:function(a,b){if(this.prevFrame!=a||!0==b)this.prevFrame!=a&&(this.prevFrame=
a),this._handleAnchorBindings(),this._updateCollider(),this.doRenderFrame(a)},doRenderFrame:function(a){},_handleAnchorBindings:function(){for(var a=null,b=null,c=-1,d=this._anchorBindings.length;++c<d;)a=this._anchorBindings[c],a.visible&&(b=this.getAnchor(a.__anchor__),null!=b&&this._updateAnchorNode(a,b))},_updateAnchorNode:function(a,b){null!=b&&(a.x=b.x,a.y=b.y,a.zIndex=b.zIndex,a.rotation=b.rotation)},onEnter:function(){this._super();this._destroyed=this.inRecycle=!1;this._tileMap&&!this._tileInited&&
this.updateTile(!0);this._updateCollider();this._physicsBodyParam&&this.createPhysics(this._physicsBodyParam.type,this._physicsBodyParam.fixedRotation,this._physicsBodyParam.bullet);if(this._physicsToBeSet)for(var a in this._physicsToBeSet){var b=this.getCollider(a),c=this._physicsToBeSet[a];b.createPhysics(c.density,c.friction,c.restitution,c.isSensor,c.catBits,c.maskBits);delete this._physicsToBeSet[a];-1==this._physicsColliders.indexOf(b)&&this._physicsColliders.push(b)}this._updateLaguage();flax.callModuleOnEnter(this);
this.__fromPool&&(this.__fromPool=!1,this.release())},onExit:function(){this._super();this.onAnimationOver.removeAll();flax.inputManager.removeListener(this);this._tileMap&&this._tileMap.removeObject(this);for(var a=this._tileMap=null,b=-1,c=this._anchorBindings.length;++b<c;)a=this._anchorBindings[b],a.destroy?a.destroy():a.removeFromParent(!0),delete a.__anchor__;for(b=this._anchorBindings.length=0;b<this._physicsColliders.length;b++)this._physicsColliders[b].destroyPhysics();this._physicsColliders=
[];this._physicsBody&&(flax.removePhysicsBody(this._physicsBody),this._physicsBody=null);this._physicsBodyParam=null;flax.callModuleOnExit(this)},_updateLaguage:function(){-1<flax.languageIndex&&this.name&&-1<this.name.indexOf("label__")&&(this.gotoAndStop(flax.languageIndex)||this.gotoAndStop(0))},getTileMap:function(){return this._tileMap},setTileMap:function(a){!a||a instanceof flax.TileMap||(a=flax.getTileMap(a));this._tileMap!=a&&(this._tileMap&&this._tileMap.removeObject(this),this._tileMap=
a,null!=this._tileMap&&this.parent&&(this.updateTile(!0),this._updateCollider()))},updateTile:function(a){if(this._tileMap){var b=this.getPosition();this.parent&&(b=this.parent.convertToWorldSpace(b));b=this._tileMap.getTileIndex(b);this.setTile(b.x,b.y,a)}},_updateCollider:function(){},setPosition:function(a,b){var c=!1;void 0===b?(c=a.x!=this.x||a.y!=this.y)&&this._super(a):(c=a!=this.x||b!=this.y)&&this._super(a,b);c&&!this.inRecycle&&(this.autoUpdateTileWhenMove&&this._tileMap&&this.updateTile(),
this._updateCollider())},setPositionX:function(a){this.setPosition(a,this.y)},setPositionY:function(a){this.setPosition(this.x,a)},setTile:function(a,b,c){if(!0===c||a!=this.tx||b!=this.ty){c=this.tx;var d=this.ty;this.tx=a;this.ty=b;this._tileMap&&this.parent&&(this._tileMap.removeObject(this,c,d),this.inRecycle||(this._tileMap.addObject(this),this._tileInited=!0))}},_destroyed:!1,destroy:function(){this._destroyed||(this._destroyed=!0,this.autoRecycle&&(this.inRecycle||flax.ObjectPool.get(this.assetsFile,
this.clsName,this.__pool__id__||"").recycle(this)),this.removeFromParent())},onRecycle:function(){this.inRecycle=!0;this.autoRecycle=!1;this.setScale(1);this.opacity=255;this.rotation=0;this.autoHideWhenOver=this.autoStopWhenOver=this.autoDestroyWhenOver=!1;this.gotoAndStop(0);this._tileInited=!1;this.setPosition(0,0);this._animSequence.length=0;this._loopSequence=!1;this._sequenceIndex=0},isMouseEnabled:function(){return this._mouseEnabled},setMouseEnabled:function(a){this._mouseEnabled=a},getDefine:function(){return null},
onNewSource:function(){}});flax.FlaxSprite.create=function(a,b){var c=new flax.FlaxSprite(a,b);c.clsName="flax.FlaxSprite";return c};window._p=flax.FlaxSprite.prototype;cc.defineGetterSetter(_p,"mainCollider",_p.getMainCollider);cc.defineGetterSetter(_p,"physicsBody",_p.getPhysicsBody);cc.defineGetterSetter(_p,"center",_p.getCenter);cc.defineGetterSetter(_p,"fps",_p.getFPS,_p.setFPS);cc.defineGetterSetter(_p,"tileMap",_p.getTileMap,_p.setTileMap);
try{cc.defineGetterSetter(_p,"x",_p.getPositionX,_p.setPositionX),cc.defineGetterSetter(_p,"y",_p.getPositionY,_p.setPositionY)}catch(e$$12){}delete window._p;flax=flax||{};
flax.Animator=flax.FlaxSprite.extend({frameNames:null,clsName:"flax.Animator",onNewSource:function(){this.frameNames=flax.assetsManager.getFrameNames(this.assetsFile,this.define.start,this.define.end);this.totalFrames=this.frameNames.length;0==this.totalFrames&&cc.log("There is no frame for display: "+this.assetID)},doRenderFrame:function(a){(a=cc.spriteFrameCache.getSpriteFrame(this.frameNames[a]))&&this.setSpriteFrame(a)},getDefine:function(){var a=flax.assetsManager.getDisplayDefine(this.assetsFile,this.assetID);
if(null==a)throw"There is no Animator named: "+this.assetID+" in assets: "+this.assetsFile;return a}});flax.Animator.create=function(a,b){var c=new flax.Animator(a,b);c.clsName="flax.Animator";return c};flax=flax||{};flax.FrameData=cc.Class.extend({x:0,y:0,rotation:0,scaleX:1,scaleY:1,opacity:255,ctor:function(a){a=a.split(",");this.x=parseFloat(a[0]);this.y=parseFloat(a[1]);this.rotation=parseFloat(a[2]);this.scaleX=parseFloat(a[3]);this.scaleY=parseFloat(a[4]);this.opacity=Math.round(255*parseFloat(a[5]))}});
flax.MovieClip=flax.FlaxSprite.extend({clsName:"flax.MovieClip",autoPlayChildren:!1,_namedChildren:null,_theRect:null,_frameDatas:null,__isMovieClip:!0,replaceChild:function(a,b){var c=this.define.children[a];if(null==c)cc.log("There is no child with named: "+a+"  in MovieClip: "+this.assetID);else{var d=this._namedChildren[a];d?d.setSource(this.assetsFile,b):c["class"]=b}},onNewSource:function(){for(var a in this._namedChildren)this._namedChildren[a].destroy(),delete this[a];this._namedChildren=
{};this.totalFrames=this.define.totalFrames;this._theRect=this._strToRect(this.define.rect);this.setContentSize(this._theRect.width,this._theRect.height);this._initFrameDatas()},_initFrameDatas:function(){this._frameDatas={};for(var a in this.define.children){for(var b=[],c=this.define.children[a].frames,d=-1;++d<c.length;)c[d]&&(b[d]=new flax.FrameData(c[d]));this._frameDatas[a]=b}},onEnter:function(){this._super();this.setContentSize(this._theRect.width,this._theRect.height)},doRenderFrame:function(a){var b,
c,d,e;for(e in this.define.children)if(c=this.define.children[e],d=this._frameDatas[e][a],b=this._namedChildren[e],d){var f=0,g=0;null==b&&(null!=c.text?(b=flax.Label.create(this.assetsFile,c),b instanceof cc.LabelTTF&&(f=c.width/2,g=-c.height/2)):b=flax.assetsManager.createDisplay(this.assetsFile,c["class"],null,!0),b.name=e,this._namedChildren[e]=b,this.autoPlayChildren&&(this.playing?b.gotoAndPlay(0):b.gotoAndStop(0)),this[e]=b,this.onNewChild(b));f=d.x+f;g=d.y+g;f!=b.x&&(b.x=f);g!=b.y&&(b.y=g);
d.rotation!=b.rotation&&(b.rotation=d.rotation);d.scaleX!=b.scaleX&&(b.scaleX=d.scaleX);d.scaleY!=b.scaleY&&(b.scaleY=d.scaleY);b.setOpacity&&d.opacity!=b.opacity&&(b.opacity=d.opacity);b.visible=!0;(b.autoPlayChildren=this.autoPlayChildren)&&(this.playing?b.play():b.stop());b.parent!=this?(b.removeFromParent(!1),this.addChild(b,c.zIndex)):b.zIndex!=c.zIndex&&(b.zIndex=c.zIndex)}else b&&(b.destroy?b.destroy():b.removeFromParent(!0),delete this._namedChildren[e])},stop:function(){this._super();if(this.autoPlayChildren)for(var a in this._namedChildren){var b=
this._namedChildren[a];b instanceof flax.FlaxSprite&&b.stop()}},play:function(){this._super();if(this.autoPlayChildren)for(var a in this._namedChildren){var b=this._namedChildren[a];b instanceof flax.FlaxSprite&&b.play()}},onNewChild:function(a){},getDefine:function(){var a=flax.assetsManager.getMc(this.assetsFile,this.assetID);if(null==a)throw"There is no MovieClip named: "+this.assetID+" in assets: "+this.assetsFile+", make sure you are a pro user!";return a},getChildOfName:function(a,b){void 0===
b&&(b=!0);var c=this._namedChildren[a];if(c)return c;if(!b)return null;for(var d in this._namedChildren)if(c=this._namedChildren[d],c.getChildOfName&&(c=c.getChildOfName(a,b)))return c},getChildByAssetID:function(a){var b=null,c;for(c in this._namedChildren)if(b=this._namedChildren[c],b.assetID==a)return b;return null},getLabelText:function(a,b){var c=this.getChildOfName(a,void 0===b?!0:b);return c&&c instanceof flax.Label?c.getString():null},setLabelText:function(a,b,c){return(a=this.getChildOfName(a,
void 0===c?!0:c))&&a instanceof flax.Label?(a.setString(b),a):null},addChildrenPhysics:function(a,b,c,d,e,f,g,h,k,m){var l=null,n;for(n in this._namedChildren)l=this._namedChildren[n],l.addPhysics(a,b,c,d,e,f,g,h,k,m)},removeChildrenPhysics:function(a){var b=null,c;for(c in this._namedChildren)b=this._namedChildren[c],b.removePhysics(a)},onRecycle:function(){this._super();this.autoPlayChildren=!1;for(var a in this._namedChildren){var b=this._namedChildren[a];b instanceof flax.FlaxSprite&&b.gotoAndStop(0)}},
_strToRect:function(a){a=a.split(",");return cc.rect(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))}});flax.MovieClip.create=function(a,b){var c=new flax.MovieClip(a,b);c.clsName="flax.MovieClip";return c};flax=flax||{};flax.ProgressBarType={HORIZONTAL:"horizontal",VERTICAL:"vertical",RADIAL:"radial"};
flax.ProgressBar=flax.Animator.extend({pBar:null,_type:flax.ProgressBarType.HORIZONTAL,_reversed:!1,_tween:null,onEnter:function(){this._super()},getPercentage:function(){return this.pBar?this.pBar.percentage:0},setPercentage:function(a){this.pBar&&(this.pBar.percentage=a)},getType:function(){return this._type},setType:function(a){this._type!=a&&(this._type=a,this._updatePBar())},getReversed:function(){return this._reversed},setReversed:function(a){this._reversed!=a&&(this._reversed=a,this._updatePBar(),
this.percentage+=0.1,this.percentage-=0.1)},tween:function(a,b,c){null!=this.pBar&&(this._tween&&this.pBar.stopAction(this._tween),this._tween=cc.ProgressFromTo.create(c,a,b),this.pBar.runAction(this._tween))},stopTween:function(){this._tween&&this.pBar&&(this.pBar.stopAction(this._tween),this._tween=null)},doRenderFrame:function(a){if(a=cc.spriteFrameCache.getSpriteFrame(this.frameNames[a]))a=cc.Sprite.create(a),null==this.pBar?(this.width=a.width,this.height=a.height,this.pBar=cc.ProgressTimer.create(a),
this._updatePBar(),this.pBar.setAnchorPoint(this.getAnchorPoint()),this.pBar.setPosition(this.getAnchorPointInPoints()),this.addChild(this.pBar)):this.pBar.setSprite(a)},_updatePBar:function(){if(null!=this.pBar)if(this._type==flax.ProgressBarType.RADIAL)this.pBar.type=0,this.pBar.setReverseDirection(this._reversed),this.pBar.midPoint=cc.p(0.5,0.5);else{this.pBar.type=1;var a=this._type==flax.ProgressBarType.HORIZONTAL,b=cc.p(0,0),c=cc.p(a?1:0,a?0:1);this._reversed&&(a?b.x=1:b.y=1);this.pBar.midPoint=
b;this.pBar.barChangeRate=c}}});flax.ProgressBar.create=function(a,b){var c=new flax.ProgressBar(a,b);c.clsName="flax.ProgressBar";return c};window._p=flax.ProgressBar.prototype;cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);cc.defineGetterSetter(_p,"reversed",_p.getReversed,_p.setReversed);delete window._p;flax=flax||{};
flax.Label=cc.Sprite.extend({mlWidth:0,mlHeight:0,fontName:null,fontSize:20,frames:[],chars:[],assetsFile:null,name:null,params:null,_str:null,_gap:0,_spaceGap:10,_charCanvas:null,_fontDefine:null,getString:function(){return this._str},setString:function(a){a!==this._str&&(this._str=""+a,this._updateStr())},getSpaceGap:function(){return this._spaceGap},setSpaceGap:function(a){this._spaceGap!=a&&(this._spaceGap=a,this._str&&-1<this._str.indexOf(" ")&&this._updateStr())},getGap:function(){return this._gap},setGap:function(a){a!=
this._gap&&(this._gap=a,this._str&&this._updateStr())},setFontName:function(a){if(null!=a&&(null==this.fontName||this.fontName!=a)){this.fontName=a;this._fontDefine=flax.assetsManager.getFont(this.assetsFile,this.fontName);if(null==this._fontDefine)throw"Can't find the font named: "+this.fontName;this.frames=flax.assetsManager.getFrameNames(this.assetsFile,parseInt(this._fontDefine.start),parseInt(this._fontDefine.end));this.chars=this._fontDefine.chars;this.fontSize=parseInt(this._fontDefine.size)}},
tweenInt:function(a,b,c){this.setString(a);var d=flax.numberSign(b-a);if(0!=d){var e=Math.abs(b-a),f=Math.max(c/e,flax.frameInterval),e=Math.round(c/f),d=d*Math.round(Math.abs(b-a)/e);this.schedule(function(a){a=parseInt(this._str);var c=a+d;0<d&&c>b?c=b:0>d&&c<b&&(c=b);c!=a&&this.setString(c)},f,e+10)}},_updateStr:function(){if(null==this._charCanvas){var a=cc.path.changeBasename(this.assetsFile,".png");this._charCanvas=new cc.SpriteBatchNode(a,this._str.length);this.addChild(this._charCanvas)}this._charCanvas.removeAllChildren();
for(i=this.mlHeight=this.mlWidth=0;i<this._str.length;i++)if(a=this._str[i],"\n"!=a)if(" "==a)this.mlWidth+=this._spaceGap;else{for(var b=-1,c=0;c<this.chars.length;c++)if(this.chars[c]==a){b=c;break}-1==b?cc.log("Not found the char: "+a+" in the fonts: "+this.fontName):(sprite=cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame(this.frames[b])),sprite.anchorX=this._fontDefine.anchorX,sprite.anchorY=this._fontDefine.anchorY,a=sprite.getContentSize(),sprite.x=this.mlWidth,sprite.y=0,this.mlWidth+=
a.width,i!=this._str.length-1&&(this.mlWidth+=this._gap),this.mlHeight=a.height>this.mlHeight?a.height:this.mlHeight,this._charCanvas.addChild(sprite))}if(this.params)for(b=Math.max(this.mlWidth/this.params.width,this.mlHeight/this.params.height),a=0,1<b&&(c=1/b,this._charCanvas.scale=c,a=this.mlHeight*(1-1/b)*b,this.mlWidth*=c,this.mlHeight*=c),b=(this.params.width-this.mlWidth)/2,i=this._charCanvas.childrenCount;i--;)charChild=this._charCanvas.children[i],"center"==this.params.align?charChild.x+=
b:"right"==this.params.align&&(charChild.x+=2*b),charChild.y-=a;this._charCanvas.setContentSize(this.mlWidth,this.mlHeight);this.setContentSize(this.mlWidth,this.mlHeight)},getRect:function(a){a=!1!==a;var b=cc.rect(0.5*this.width/this._str.length,-this.params.height,this.width,this.height+2);b.y+=(this.params.height-this.height)/2-1;if(!a)return b;a=b.width;var c=b.height,b=cc.p(b.x,b.y),b=this.convertToWorldSpace(b);return cc.rect(b.x,b.y,a,c)},destroy:function(){this.removeFromParent()}});
window._p=flax.Label.prototype;cc.defineGetterSetter(_p,"gap",_p.getGap,_p.setGap);cc.defineGetterSetter(_p,"spaceGap",_p.getSpaceGap,_p.setSpaceGap);cc.defineGetterSetter(_p,"text",_p.getString,_p.setString);delete window._p;window._p=cc.LabelTTF.prototype;cc.defineGetterSetter(_p,"text",_p.getString,_p.setString);delete window._p;
flax.Label.create=function(a,b){var c=null,d=b["class"],c=flax.assetsManager.getFont(a,d);if(!0==b.input){if(null==cc.EditBox)throw"If you want to use input text, please add module of 'editbox' into project.json!";d=flax.assetsManager.getFrameNamesOfDisplay(a,d);c=new cc.EditBox(cc.size(b.width,b.height),new cc.Scale9Sprite(d[0]),d[1]?new cc.Scale9Sprite(d[1]):null,d[2]?new cc.Scale9Sprite(d[2]):null);c.setFontColor(cc.hexToColor(b.color));c.setFontName(b.font);c.setFontSize(b.size);c.setPlaceHolder(b.text);
c.setPlaceholderFontName(b.font);c.setPlaceholderFontSize(b.size)}else b.font&&null==c?(c=new cc.FontDefinition,c.fontName=b.font,c.fontSize=b.size,c.textAlign=H_ALIGHS.indexOf(b.align),c.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_CENTER,c.fillStyle=cc.hexToColor(b.color),c.fontDimensions=!0,c.boundingWidth=b.width,c.boundingHeight=b.height,c="null"==d?new cc.LabelTTF(b.text,c):new cc.LabelTTF(flax.getLanguageStr(d)||b.text,c)):(c=new flax.Label,flax.assetsManager.addAssets(a),c.assetsFile=a,c.params=
b,c.setFontName(d),c.setAnchorPoint(0,0),c.setString(b.text));return c};var flax=flax||{},ButtonState={UP:"up",OVER:"over",DOWN:"down",SELECTED:"selected",SELECTED_OVER:"selected_over",SELECTED_DOWN:"selected_down",DISABLED:"disabled"};MOUSE_DOWN_SCALE=0.95;flax._radioButtons={};
flax._buttonDefine={clickSound:null,_radioGroup:"",_state:null,_initScale:null,onEnter:function(){this._super();this._initScale={x:this.scaleX,y:this.scaleY};flax.inputManager.addListener(this,this._onPress,InputType.press);flax.inputManager.addListener(this,this._onClick,InputType.click);flax.inputManager.addListener(this,this._onMove,InputType.move)},onExit:function(){this._removeRadioGroup();this._super()},setState:function(a){this._state!=a&&(this._state=a,this.gotoAndStop(this._state)||(a=this.isSelected()?
ButtonState.SELECTED:ButtonState.UP,this.gotoAndStop(a)||(1==this.totalFrames&&this._initScale&&(-1<this._state.indexOf("down")?(this.scaleX=this._initScale.x*MOUSE_DOWN_SCALE,this.scaleY=this._initScale.y*MOUSE_DOWN_SCALE):(this.scaleX=this._initScale.x,this.scaleY=this._initScale.y)),this.gotoAndStop(0))))},getState:function(){return this._state},setRadioGroup:function(a){a&&a!=this._radioGroup&&(this._radioGroup?cc.log("Button's radioGroup could be set only once!"):(this._radioGroup=a,null==flax._radioButtons[this._radioGroup]&&
(flax._radioButtons[this._radioGroup]=[]),flax._radioButtons[this._radioGroup].push(this)))},getRadioGroup:function(){return this._radioGroup},isSelected:function(){return this._state==ButtonState.SELECTED||this._state==ButtonState.SELECTED_OVER||this._state==ButtonState.SELECTED_DOWN},isSelectable:function(){return this.hasLabel(ButtonState.SELECTED)},setMouseEnabled:function(a){if(this.isMouseEnabled()==a)return!1;this.setState(a?ButtonState.UP:ButtonState.DISABLED);return!0},isMouseEnabled:function(){return this._state!=
ButtonState.DISABLED},_removeRadioGroup:function(){if(this._radioGroup){var a=flax._radioButtons[this._radioGroup];if(null!=a){var b=a.indexOf(this);-1<b&&a.splice(b,1)}}},_onPress:function(a,b){var c=this.clickSound||flax.buttonSound;c&&flax.playSound(c);this._toSetState(ButtonState.DOWN)},_onClick:function(a,b){if(this.isSelectable())if(!this.isSelected()||this._radioGroup){if(!this.isSelected()&&this._radioGroup){var c=flax._radioButtons[this._radioGroup];if(c&&1<c.length)for(var d=0;d<c.length;d++)c[d]!=
this&&c[d].setState(ButtonState.UP)}this.setState(ButtonState.SELECTED)}else this.setState(ButtonState.UP);else this.setState(ButtonState.UP)},_onMove:function(a,b){flax.ifTouched(this,a.getLocation())?this._toSetState(ButtonState.DOWN):this._toSetState(ButtonState.UP)},_toSetState:function(a){this.isSelectable()&&this.isSelected()&&(a=a==ButtonState.UP?ButtonState.SELECTED:"selected_"+a);this.setState(a)}};flax.SimpleButton=flax.Animator.extend(flax._buttonDefine);
flax.SimpleButton.create=function(a,b){var c=new flax.SimpleButton(a,b);c.clsName="flax.SimpleButton";c.setState(ButtonState.UP);return c};window._p=flax.SimpleButton.prototype;cc.defineGetterSetter(_p,"state",_p.getState,_p.setState);cc.defineGetterSetter(_p,"radioGroup",_p.getRadioGroup,_p.setRadioGroup);delete window._p;flax.Button=flax.MovieClip.extend(flax._buttonDefine);flax.Button.create=function(a,b){var c=new flax.Button(a,b);c.clsName="flax.Button";c.setState(ButtonState.UP);return c};
flax.Button.reset=function(){flax._radioButtons={}};window._p=flax.Button.prototype;cc.defineGetterSetter(_p,"state",_p.getState,_p.setState);cc.defineGetterSetter(_p,"radioGroup",_p.getRadioGroup,_p.setRadioGroup);delete window._p;/*
 zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
(function(){function a(a,b){var c=a.split("."),d=g;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function b(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,e,f,g,k,l,m,p,q,n;for(q=0;q<b;++q)a[q]>c&&(c=a[q]),a[q]<d&&(d=a[q]);e=1<<c;f=new (h?Uint32Array:Array)(e);g=1;k=0;for(l=2;g<=c;){for(q=0;q<b;++q)if(a[q]===g){m=0;p=k;for(n=0;n<g;++n)m=m<<1|p&1,p>>=1;p=g<<16|q;for(n=m;n<e;n+=l)f[n]=p;++k}++g;k<<=1;l<<=1}return[f,
c,d]}function c(a,b){this.g=[];this.h=32768;this.c=this.f=this.d=this.k=0;this.input=h?new Uint8Array(a):a;this.l=!1;this.i=m;this.q=!1;if(b||!(b={}))b.index&&(this.d=b.index),b.bufferSize&&(this.h=b.bufferSize),b.bufferType&&(this.i=b.bufferType),b.resize&&(this.q=b.resize);switch(this.i){case k:this.a=32768;this.b=new (h?Uint8Array:Array)(32768+this.h+258);break;case m:this.a=0;this.b=new (h?Uint8Array:Array)(this.h);this.e=this.v;this.m=this.s;this.j=this.t;break;default:throw Error("invalid inflate mode");
}}function d(a,b){for(var c=a.f,d=a.c,e=a.input,f=a.d,g=e.length;d<b;){if(f>=g)throw Error("input buffer is broken");c|=e[f++]<<d;d+=8}a.f=c>>>b;a.c=d-b;a.d=f;return c&(1<<b)-1}function e(a,b){for(var c=a.f,d=a.c,e=a.input,f=a.d,g=e.length,h=b[0],k=b[1];d<k&&!(f>=g);)c|=e[f++]<<d,d+=8;e=h[c&(1<<k)-1];g=e>>>16;a.f=c>>g;a.c=d-g;a.d=f;return e&65535}function f(a){function c(a,b,f){var g,h=this.p,k,l;for(l=0;l<a;)switch(g=e(this,b),g){case 16:for(k=3+d(this,2);k--;)f[l++]=h;break;case 17:for(k=3+d(this,
3);k--;)f[l++]=0;h=0;break;case 18:for(k=11+d(this,7);k--;)f[l++]=0;h=0;break;default:h=f[l++]=g}this.p=h;return f}var f=d(a,5)+257,g=d(a,5)+1,k=d(a,4)+4,l=new (h?Uint8Array:Array)(n.length),m;for(m=0;m<k;++m)l[n[m]]=d(a,3);if(!h)for(m=k,k=l.length;m<k;++m)l[n[m]]=0;k=b(l);l=new (h?Uint8Array:Array)(f);m=new (h?Uint8Array:Array)(g);a.p=0;a.j(b(c.call(a,f,k,l)),b(c.call(a,g,k,m)))}var g=this,h="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==
typeof DataView,k=0,m=1;c.prototype.u=function(){for(;!this.l;){var a=d(this,3);a&1&&(this.l=!0);a>>>=1;switch(a){case 0:var a=this.input,b=this.d,c=this.b,e=this.a,g=a.length,l=void 0,s=void 0,n=c.length,s=void 0;this.c=this.f=0;if(b+1>=g)throw Error("invalid uncompressed block header: LEN");l=a[b++]|a[b++]<<8;if(b+1>=g)throw Error("invalid uncompressed block header: NLEN");s=a[b++]|a[b++]<<8;if(l===~s)throw Error("invalid uncompressed block header: length verify");if(b+l>a.length)throw Error("input buffer is broken");
switch(this.i){case k:for(;e+l>c.length;){s=n-e;l-=s;if(h)c.set(a.subarray(b,b+s),e),e+=s,b+=s;else for(;s--;)c[e++]=a[b++];this.a=e;c=this.e();e=this.a}break;case m:for(;e+l>c.length;)c=this.e({o:2});break;default:throw Error("invalid inflate mode");}if(h)c.set(a.subarray(b,b+l),e),e+=l,b+=l;else for(;l--;)c[e++]=a[b++];this.d=b;this.a=e;this.b=c;break;case 1:this.j(z,A);break;case 2:f(this);break;default:throw Error("unknown BTYPE: "+a);}}return this.m()};var l=[16,17,18,0,8,7,9,6,10,5,11,4,12,
3,13,2,14,1,15],n=h?new Uint16Array(l):l,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],t=h?new Uint16Array(l):l,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],v=h?new Uint8Array(l):l,l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],x=h?new Uint16Array(l):l,l=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],w=h?new Uint8Array(l):l,l=new (h?Uint8Array:
Array)(288),p,r;p=0;for(r=l.length;p<r;++p)l[p]=143>=p?8:255>=p?9:279>=p?7:8;var z=b(l),l=new (h?Uint8Array:Array)(30);p=0;for(r=l.length;p<r;++p)l[p]=5;var A=b(l);c.prototype.j=function(a,b){var c=this.b,f=this.a;this.n=a;for(var g=c.length-258,h,k,l;256!==(h=e(this,a));)if(256>h)f>=g&&(this.a=f,c=this.e(),f=this.a),c[f++]=h;else for(h-=257,l=t[h],0<v[h]&&(l+=d(this,v[h])),h=e(this,b),k=x[h],0<w[h]&&(k+=d(this,w[h])),f>=g&&(this.a=f,c=this.e(),f=this.a);l--;)c[f]=c[f++-k];for(;8<=this.c;)this.c-=
8,this.d--;this.a=f};c.prototype.t=function(a,b){var c=this.b,f=this.a;this.n=a;for(var g=c.length,h,k,l;256!==(h=e(this,a));)if(256>h)f>=g&&(c=this.e(),g=c.length),c[f++]=h;else for(h-=257,l=t[h],0<v[h]&&(l+=d(this,v[h])),h=e(this,b),k=x[h],0<w[h]&&(k+=d(this,w[h])),f+l>g&&(c=this.e(),g=c.length);l--;)c[f]=c[f++-k];for(;8<=this.c;)this.c-=8,this.d--;this.a=f};c.prototype.e=function(){var a=new (h?Uint8Array:Array)(this.a-32768),b=this.a-32768,c,d,e=this.b;if(h)a.set(e.subarray(32768,a.length));else for(c=
0,d=a.length;c<d;++c)a[c]=e[c+32768];this.g.push(a);this.k+=a.length;if(h)e.set(e.subarray(b,b+32768));else for(c=0;32768>c;++c)e[c]=e[b+c];this.a=32768;return e};c.prototype.v=function(a){var b,c=this.input.length/this.d+1|0,d,e,f,g=this.input,k=this.b;a&&("number"===typeof a.o&&(c=a.o),"number"===typeof a.r&&(c+=a.r));2>c?(d=(g.length-this.d)/this.n[2],f=d/2*258|0,e=f<k.length?k.length+f:k.length<<1):e=k.length*c;h?(b=new Uint8Array(e),b.set(k)):b=k;return this.b=b};c.prototype.m=function(){var a=
0,b=this.b,c=this.g,d,e=new (h?Uint8Array:Array)(this.k+(this.a-32768)),f,g,k,l;if(0===c.length)return h?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(g=c.length;f<g;++f)for(d=c[f],k=0,l=d.length;k<l;++k)e[a++]=d[k];f=32768;for(g=this.a;f<g;++f)e[a++]=b[f];this.g=[];return this.buffer=e};c.prototype.s=function(){var a,b=this.a;h?this.q?(a=new Uint8Array(b),a.set(this.b.subarray(0,b))):a=this.b.subarray(0,b):(this.b.length>b&&(this.b.length=b),a=this.b);return this.buffer=a};a("Zlib.RawInflate",
c);a("Zlib.RawInflate.prototype.decompress",c.prototype.u);var l={ADAPTIVE:m,BLOCK:k},u,y;if(Object.keys)p=Object.keys(l);else for(u in p=[],r=0,l)p[r++]=u;r=0;for(y=p.length;r<y;++r)u=p[r],a("Zlib.RawInflate.BufferType."+u,l[u])}).call(this);flax=flax||{};
flax.Preloader=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"flax.Preloader",_logo:null,init:function(){var a=this,b=cc.director.getWinSize(),c=cc.p(b.width/2,b.height/2),d=cc.game.config.loading;d&&flax.isImageFile(d)?cc.loader.load(d,function(){a._logo=cc.Sprite.create(d);a._logo.setPosition(c);a.addChild(a._logo,10);cc.sys.isNative||a.createLabel(cc.pSub(c,cc.p(0,a._logo.height/2+10)));a.logoClick()}):a.createLabel(c);return!0},createLabel:function(a){var b=this._label=
cc.LabelTTF.create("Loading...","Arial",16);b.enableStroke(cc.color(51,51,51),2);b.setColor(cc.color(255,255,255));b.setPosition(a);this.addChild(b,10)},logoClick:function(){var a=this._logo,b=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(b,d){cc.rectContainsPoint(flax.getRect(a,!0),b.getLocation())&&flax.goHomeUrl()}});cc.eventManager.addListener(b,this._logo)},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.schedule(this._startLoading,
0.3)},onExit:function(){cc.Node.prototype.onExit.call(this);this._label&&this._label.setString("Loaded")},initWithResources:function(a,b){"string"==typeof a&&(a=[a]);this.resources=a||[];this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);cc.loader.load(a.resources,function(b,c,d){null!=a._label&&(Math.min(d/c*100|0,100),a._label.setString("Loading: "+(d+1)+"/"+c))},function(){a.cb&&a.cb()})}});
flax.preload=function(a,b){if(null!=a&&0!=a.length){for(var c=!1,d=[],e=a.length;e--;){var f=a[e];if(null==f)throw"There is a null resource!";if(null==cc.loader.getRes(f))if(f=flax._addResVersion(f),".flax"!=cc.path.extname(f)||!cc.sys.isNative&&!1!==cc.game.config.useFlaxRes)c=!0,d.unshift(f);else{cc.sys.isNative&&cc.log("***Warning: .flax is not support JSB for now, use .plist + .png insteadly!");var g=cc.path.changeBasename(f,".plist"),f=cc.path.changeBasename(f,".png");d.unshift(g);d.unshift(f);
null==cc.loader.getRes(f)&&(c=!0)}}if(c)return c=new flax.Preloader,c.init(),c.initWithResources(d,function(){if(!cc.sys.isNative)for(var a=d.length;a--;){var c=d[a],e=cc.loader.getRes(c);if(e){var f=flax._removeResVersion(c);cc.loader.cache[f]=e;flax.isImageFile(f)&&cc.sys.capabilities.opengl&&cc.textureCache.handleLoadedTexture(f);cc.loader.release(c)}}b()}),cc.director.runScene(c),c}b()};flax=flax||{};ALL_DIRECTONS="UP DOWN LEFT RIGHT LEFT_UP RIGHT_UP RIGHT_DOWN LEFT_DOWN".split(" ");ALL_DIRECTONS0="UP DOWN LEFT RIGHT LEFT_UP LEFT_DOWN".split(" ");ALL_DIRECTONS1="UP DOWN LEFT RIGHT RIGHT_UP RIGHT_DOWN".split(" ");EIGHT_DIRECTIONS_VALUE={UP:[0,1],DOWN:[0,-1],LEFT:[-1,0],RIGHT:[1,0],LEFT_UP:[-1,1],RIGHT_UP:[1,1],RIGHT_DOWN:[1,-1],LEFT_DOWN:[-1,-1]};MAX_IN_TILE=10;
flax.TileMap=cc.Class.extend({id:"default",offsetX:0,offsetY:0,isHexagon:!1,autoLayout:!1,_tileWidth:0,_tileHeight:0,_mapWidth:0,_mapHeight:0,_objectsMap:null,_objectsArr:null,_inUpdate:!1,update:function(a){for(a=this._objectsArr?this._objectsArr.length:0;a--;){var b=this._objectsArr[a];b.autoUpdateTileWhenMove&&b.updateTile()}},setTileSize:function(a,b){if(this._tileWidth!=a||this._tileHeight!=b)this._tileWidth=a,this._tileHeight=b},getTileSize:function(){return{width:this._tileWidth,height:this._tileHeight}},
setMapSizePixel:function(a,b){null==a&&(a=cc.visibleRect.width);null==b&&(b=cc.visibleRect.height);return this.setMapSize(Math.ceil(a/this._tileWidth),Math.ceil(b/this._tileHeight))},setMapSize:function(a,b){var c=[[],[]];if(this._mapWidth==a&&this._mapHeight==b)return c;null==this._objectsArr&&(this._objectsArr=[]);null==this._objectsMap&&(this._objectsMap=[]);for(var d=this._mapWidth,e=this._mapHeight,f=-1,g=-1,h=Math.max(a,d),k=Math.max(b,e);++f<h;){null==this._objectsMap[f]&&(this._objectsMap[f]=
[]);for(g=-1;++g<k;)f>=a||g>=b?(c[0]=c[0].concat(this._objectsMap[f][g]),this.removeObjects(f,g),delete this._objectsMap[f][g]):f<d&&g<e||(this._objectsMap[f][g]=[],c[1].push([f,g]));0==this._objectsMap[f].length&&delete this._objectsMap[f]}this._mapWidth=a;this._mapHeight=b;return c},getMapSize:function(){return{width:this._mapWidth,height:this._mapHeight}},showDebugGrid:function(){if(null!=flax.currentScene){flax.tileMapCanvas?flax.tileMapCanvas.clear():(flax.tileMapCanvas=cc.DrawNode.create(),
flax.currentScene.addChild(flax.tileMapCanvas,1E5));flax.tileMapCanvas.setPosition(this.offsetX,this.offsetY);for(var a=0;a<=this._mapWidth;a++)flax.tileMapCanvas.drawSegment(cc.p(a*this._tileWidth,0),cc.p(a*this._tileWidth,this._tileHeight*this._mapHeight),1,cc.color(255,0,0,255));for(a=0;a<=this._mapHeight;a++)flax.tileMapCanvas.drawSegment(cc.p(0,a*this._tileHeight),cc.p(this._tileWidth*this._mapWidth,a*this._tileHeight),1,cc.color(255,0,0,255))}},showDebugTile:function(a,b,c){a=this.getTiledPosition(a,
b);null==c&&(c=cc.color(0,255,0,128));flax.drawRect(cc.rect(a.x-this._tileWidth/2,a.y-this._tileHeight/2,this._tileWidth,this._tileHeight),1,c,c)},clear:function(a){if(0!=this._objectsArr.length){void 0===a&&(a=!0);for(var b,c=0;c<this._mapWidth;c++)for(var d=0;d<this._mapHeight;d++){if(a){b=this._objectsMap[c][d];for(var e in b){var f=b[e];f instanceof cc.Node&&f.destroy()}}this._objectsMap[c][d]=[]}this._objectsArr.length=0}},getPixelSize:function(){var a=cc.size(this._tileWidth*this._mapWidth,
this._tileHeight*this._mapHeight);this.isHexagon&&(a.width+=0.5*this._tileWidth);return a},getTileIndex:function(a){var b=Math.floor((a.x-this.offsetX)/this._tileWidth),c=Math.floor((a.y-this.offsetY)/this._tileHeight);this.isHexagon&&0!=c%2&&(b=Math.floor((a.x-this.offsetX-0.5*this._tileWidth)/this._tileWidth));return cc.p(b,c)},getTiledPosition:function(a,b){var c=(a+0.5)*this._tileWidth+this.offsetX,d=(b+0.5)*this._tileHeight+this.offsetY;this.isHexagon&&0!=b%2&&(c+=0.5*this._tileWidth);return cc.p(c,
d)},getCoveredTiles:function(a,b){var c=flax.getRect(a,!0);return this.getCoveredTiles1(c,b)},getCoveredTiles1:function(a,b){b=!0===b;for(var c=this.getTileIndex(cc.p(a.x,a.y)),d=c.x,e=c.y,c=this.getTileIndex(cc.p(a.x+a.width,a.y+a.height)),f=c.x,c=c.y,g=[],d=d-1,h=0;++d<=f;)for(h=e-1;++h<=c;)b?g=g.concat(this.getObjects(d,h)):g.push(cc.p(d,h));return g},isValideTile:function(a,b){return 0<=a&&a<this._mapWidth&&0<=b&&b<this._mapHeight},snapToTile:function(a,b,c,d){if(a instanceof cc.Node){var e=null;
if(null==b||null==c)e=a.getPosition(),a.parent&&(e=a.parent.convertToWorldSpace(e)),c=this.getTileIndex(e),b=c.x,c=c.y;e=this.getTiledPosition(b,c);a.parent&&(e=a.parent.convertToNodeSpace(e));a.setPosition(e);!0===d&&a.setTileMap(this)}},snapAll:function(){for(var a=this._objectsArr.length,b=-1,c=null;++b<a;)c=this._objectsArr[b],this.snapToTile(c)},addObject:function(a,b,c){void 0===b&&(b=a.tx);void 0===c&&(c=a.ty);a.tx=b;a.ty=c;if(this.isValideTile(b,c)&&!(-1<this._objectsArr.indexOf(a))){this._objectsArr.push(a);
var d=this._objectsMap[b][c];!this._inUpdate&&cc.sys.isNative&&(this._inUpdate=!0,cc.director.getScheduler().scheduleUpdateForTarget(this));if(a instanceof cc.Node&&this.autoLayout){b=(b+(this._mapHeight-1-c)*this._mapWidth)*MAX_IN_TILE;c=null;for(var e=0,f=!1,g=0;g<d.length;g++)c=d[g],c instanceof cc.Node&&(!f&&c.y<=a.y&&(d.splice(g,0,a),a.zIndex=Math.min(e,MAX_IN_TILE)+b,f=!0,e++,g++),c.zIndex=Math.min(e,MAX_IN_TILE)+b,e++);f||(d.push(a),a.zOrder=Math.min(e,MAX_IN_TILE)+b)}else d.push(a)}},updateLayout:function(a,
b){if(this.isValideTile(a,b)){var c=this._objectsMap[a][b];if(0!=c.length){c.sort(this._sortByY);for(var d=null,e=0,f=0;f<c.length;f++)d=c[f],d instanceof cc.Node&&(d.zIndex=Math.min(e,MAX_IN_TILE)+zIndex0,e++)}}},removeObject:function(a,b,c){void 0===b&&(b=a.tx);void 0===c&&(c=a.ty);this.isValideTile(b,c)&&(b=this._objectsMap[b][c],c=b.indexOf(a),-1<c&&b.splice(c,1),c=this._objectsArr.indexOf(a),-1<c&&this._objectsArr.splice(c,1));this._inUpdate&&cc.sys.isNative&&0==this._objectsArr.length&&(this._inUpdate=
!1,cc.director.getScheduler().unscheduleUpdateForTarget(this))},removeObjects:function(a,b){if(this.isValideTile(a,b))for(var c=this._objectsMap[a][b],d=null,d=-1;c.length;)d=c[0],d.tx=d.ty=-1,d=this._objectsArr.indexOf(d),-1<d&&this._objectsArr.splice(d,1),c.splice(0,1)},getObjects:function(a,b){return this.isValideTile(a,b)?this._objectsMap[a][b]:[]},getObjects1:function(a,b){var c=this.getTileIndex(cc.p(a,b));return this.getObjects(c.x,c.y)},getAllObjects:function(){return this._objectsArr},getTiles:function(a){for(var b=
[],c=-1,d=-1;++c<this._mapWidth;)for(d=-1;++d<this._mapHeight;)null!=a&&!1===a(this,c,d)||b.push(cc.p(c,d));return b},getRow:function(a,b){for(var c=-1,d=[];++c<this._mapHeight;)d=!0===b?d.concat(this.getObjects(a,c)):d.push(cc.p(a,c));return d},getCol:function(a,b){for(var c=-1,d=[];++c<this._mapWidth;)d=!0===b?d.concat(this.getObjects(c,a)):d.push(cc.p(c,a));return d},__tilesSearched:null,__nonRecursive:!1,findConnectedObjects:function(a,b,c){this.__tilesSearched={};b=this.findNeighbors(a,b,c,null,
!1);a=b.indexOf(a);-1<a&&b.splice(a,1);this.__tilesSearched=null;return b},findNeighbors:function(a,b,c,d,e){for(var f=this._getAllDirections(a,c,d),g=!this.__nonRecursive&&null!=this.__tilesSearched,h=[],k=f.length;k--;){var m=EIGHT_DIRECTIONS_VALUE[f[k]],l=a.tx+m[0],m=a.ty+m[1];if(this.__tilesSearched){var n=l+"-"+m;if(!0===this.__tilesSearched[n])continue;this.__tilesSearched[n]=!0}if(e)h.push({x:l,y:m});else for(var l=this.getObjects(l,m),m=null,n=!1,t=0;t<l.length;t++)if(m=l[t],null==b||0==b.length||
m[b]===a[b])h.push(m),!n&&g&&(h=h.concat(this.findNeighbors(m,b,c,d,e)),n=!0)}return h},findSeparatedGroups:function(){var a=[],b=null;this.__tilesSearched={};var c=this.getAllObjects(),d=[],e=c.length;for(i=0;i<e;i++)nb=c[i],-1<d.indexOf(nb)||(b=this.findNeighbors(nb),b.length||!0===this.__tilesSearched[nb.tx+"-"+nb.ty]||(b=[nb],this.__tilesSearched[nb.tx+"-"+nb.ty]=!0),a.push(b),d=d.concat(b));this.__tilesSearched=null;return a},findSurroundings:function(a,b,c,d){if(null==b||1>b)b=1;a=[a];var e=
[];this.__tilesSearched={};for(this.__nonRecursive=!0;b--;){for(var f=[],g=0;g<a.length;g++){var h=a[g];void 0===h.tx&&(h={tx:h.x,ty:h.y});f=f.concat(this.findNeighbors(h,null,!0,null,c&&d?!c:!0))}a=f;if(c&&!d){for(var k=[],g=0;g<f.length;g++)h=f[g],k=k.concat(this.getObjects(h.x,h.y));e.push(k)}else e.push(f)}this.__tilesSearched=null;this.__nonRecursive=!1;return e},_getAllDirections:function(a,b,c){var d=ALL_DIRECTONS;this.isHexagon?d=0==a.ty%2?ALL_DIRECTONS0:ALL_DIRECTONS1:b||(d=d.slice(0,4));
a=ALL_DIRECTONS.indexOf(c);if(-1==a||3<a)return d;b=[];var e=null;for(a=0;a<d.length;a++)e=d[a],-1<e.indexOf(c)&&b.push(e);this.isHexagon&&1==b.length&&b.push("UP","DOWN");return b},isEmptyTile:function(a,b){if(!this.isValideTile(a,b))return!1;var c=this.getObjects(a,b);return c?0==c.length:!1},_sortByY:function(a,b){if(a.y>b.y)return-1;if(a.y<b.y)return 1}});flax.TileMap.create=function(a){var b=new flax.TileMap;b.id=a;return b};window._p=flax.TileMap.prototype;_p.tileSize;
cc.defineGetterSetter(_p,"tileSize",_p.getTileSize);_p.mapSize;cc.defineGetterSetter(_p,"mapSize",_p.getMapSize);delete window._p;flax=flax||{};flax.userData={};flax.fetchUserData=function(a){var b=null;try{(b=cc.sys.localStorage.getItem(cc.game.config.gameId))&&(b=JSON.parse(b))}catch(c){cc.log("Fetch UserData Error: "+c.name)}b?flax.copyProperties(b,flax.userData):a&&(flax.userData=a);flax.userData||(flax.userData={})};flax.saveUserData=function(){flax.userData||(flax.userData={});try{cc.sys.localStorage.setItem(cc.game.config.gameId,JSON.stringify(flax.userData))}catch(a){cc.log("Save UserData Error: "+a.name)}};flax=flax||{};
flax.ObjectPool=cc.Class.extend({maxCount:100,_clsName:null,_cls:null,_assetsFile:null,_pool:null,_extraID:"",init:function(a,b,c){if(this._assetsFile&&this._cls)return cc.log("The pool has been inited with cls: "+this._cls),!1;this._clsName=b;this._cls=flax.nameToObject(b);if(null==this._cls)return cc.log("There is no class named: "+b),!1;this._assetsFile=a;this._pool=[];void 0!==c&&(this.maxCount=c);return!0},fetch:function(a,b,c){if(null==a)return cc.log("Please give me a assetID to fetch a object!"),null;
var d=null;0<this._pool.length?(d=this._pool.shift(),d.__fromPool=!0,d.setSource(this._assetsFile,a)):d=this._cls.create?this._cls.create(this._assetsFile,a):new this._cls(this._assetsFile,a);d.__pool__id__=this._extraID;d.clsName=this._clsName;d.autoRecycle=!0;d.visible=!0;c?"undefined"===typeof c.zIndex&&(c.zIndex=0):c={zIndex:0};d.attr(c);b&&b.addChild(d);return d},recycle:function(a){a instanceof this._cls?this._pool.length<this.maxCount&&(a.onRecycle&&a.onRecycle(),a.retain&&a.retain(),this._pool.push(a)):
cc.log("The object to recycle is not the same type with this pool: "+this._cls)},release:function(){for(var a=this._pool.length;a--;)this._pool[a].release&&this._pool[a].release();this._pool.length=0}});flax.ObjectPool.all={};flax.ObjectPool.create=function(a,b,c){var d=new flax.ObjectPool;return d.init(a,b,c)?d:null};
flax.ObjectPool.get=function(a,b,c){null==b&&(b="flax.Animator");null==c&&(c="");var d=a+b+c,e=flax.ObjectPool.all[d];null==e&&(e=flax.ObjectPool.create(a,b),e._extraID=c,flax.ObjectPool.all[d]=e);return e};flax.ObjectPool.release=function(){for(var a in flax.ObjectPool.all)flax.ObjectPool.all[a].release(),delete flax.ObjectPool.all[a]};flax=flax||{};flax.GunParam=cc.Class.extend({bulletAssets:null,bulletID:null,targetMap:null,selfMap:null,damage:1,damageRadius:0,speed:600,interval:0.15,count:1,angleGap:5,angleOffset:0,waveInterval:0,countInWave:6,gravityX:0,gravityY:0,fireSound:null,fireEffectID:null,hitEffectID:null,alwaysLive:!1,bulletPlayOnce:!1,fps:30,isMissle:!1});flax.GunParam.create=function(a){var b=new flax.GunParam;0==a.speed&&(a.speed=0.001);flax.copyProperties(a,b);return b};
flax.Gun=cc.Node.extend({owner:null,param:null,aimTarget:null,_firing:!1,_targetMap:null,_canvas:null,start:function(){this._firing||(this._firing=!0,this._canvas=flax.BulletCanvas.fetch(this.param.bulletAssets),0>=this.param.waveInterval||1>this.param.countInWave?(this.schedule(this.shootOnce,this.param.interval),this.shootOnce()):this._waveFire())},end:function(){this._firing&&(this._firing=!1,this.unschedule(this.shootOnce),this.unschedule(this._createWave))},updateParam:function(a){null!=a&&(flax.copyProperties(a,
this.param),this.end(),this.start())},isFiring:function(){return this._firing},_waveFire:function(){this._firing&&(this._createWave(),this.schedule(this._createWave,this.param.interval*this.param.countInWave+this.param.waveInterval,cc.REPEAT_FOREVER))},shootOnce:function(){if(null!=this.parent){var a=this.parent.convertToWorldSpace(this.getPosition());this.aimTarget&&(this.rotation=flax.getAngle(flax.getPosition(this,!0),this.aimTarget.center)-this.param.angleOffset-this.parent.rotation);for(var a=
this._canvas.convertToNodeSpace(a),b=flax.getRotation(this,!0),c=-1,d=0,e=0,f=flax.createDInts(this.param.count);++c<this.param.count;)e=f[c],d=b+e*this.param.angleGap,this._canvas.addBullet(d,a,this.param,this.owner);this._showFireEffect(a,d);this.param.fireSound&&flax.playSound(this.param.fireSound)}},_createWave:function(){1<this.param.countInWave?this.schedule(this.shootOnce,this.param.interval,this.param.countInWave-1):this.shootOnce()},_showFireEffect:function(a,b){if(null!=this.param.fireEffectID&&
""!=this.param.fireEffectID){var c=flax.assetsManager.createDisplay(this.param.bulletAssets,this.param.fireEffectID,{parent:this._canvas},!0);c.zIndex=999;c.autoDestroyWhenOver=!0;c.setPosition(a);c.setRotation(b);c.gotoAndPlay(0)}}});
flax.BulletCanvas=cc.SpriteBatchNode.extend({stageRect:null,assetsFile:null,onBulletHit:null,onBulletOut:null,_bullets:null,onEnter:function(){this._super();this._bullets=[];null==this.stageRect&&(this.stageRect=cc.rect(0,0,cc.visibleRect.width,cc.visibleRect.height));this.onBulletHit=new signals.Signal;this.onBulletOut=new signals.Signal;this.scheduleUpdate()},onExit:function(){this._super();this.onBulletHit.removeAll();this.onBulletOut.removeAll()},addBullet:function(a,b,c,d){if(null==this.parent)cc.log("Please add the bullet canvas to the stage: container.addChild(flax.BulletCanvas.fetch('"+
this.assetsFile+"'));");else{c instanceof flax.GunParam||(c=flax.GunParam.create(c));var e=flax.assetsManager.createDisplay(c.bulletAssets,c.bulletID,{parent:this},!0);e.owner=d;e.param=c;d&&d.targets&&(e.targets=d.targets);c.targetMap&&(e.targetMap=flax.getTileMap(c.targetMap));e.fps=c.fps;e.__physicalShooted=!1;if(e instanceof flax.MovieClip){e.__isMovieClip=!0;e.autoPlayChildren=!0;e.autoDestroyWhenOver=!0;d=e.children.length;for(var f;d--;)f=e.children[d],c.selfMap&&f.setTileMap(c.selfMap),f.__isBullet=
!0,f.__canvas=this,f.__body=e}else c.selfMap&&(e.setTileMap(c.selfMap),e.__isBullet=!0,e.__canvas=this,e.__body=e);e.play();e.autoStopWhenOver=c.bulletPlayOnce;e.setPosition(b);e.setRotation(a);b=c.damage;b instanceof Array&&(1==b.length?b=b[0]:2<=b.length&&(b=flax.randInt(b[0],b[1])));e.damage=b;a=DEGREE_TO_RADIAN*(90-(a+c.angleOffset));e.__vx=c.speed*Math.cos(a);e.__vy=c.speed*Math.sin(a);this._bullets.push(e);return e}},destroyBullet:function(a,b,c){void 0===b&&(b=this._bullets.indexOf(a));0>b||
(!1!==c&&a.destroy(),this._bullets.splice(b,1))},update:function(a){var b=this._bullets.length;if(0!=b)for(var c=null,d=null,d=null,e=!1,e=null;b--;){c=this._bullets[b];c.physicsBody?c.__physicalShooted||(c.physicsBody.SetLinearVelocity({x:c.__vx/PTM_RATIO,y:c.__vy/PTM_RATIO}),c.__physicalShooted=!0):(c.__vx+=c.param.gravityX*a,c.__vy+=c.param.gravityY*a,c.x+=c.__vx*a,c.y+=c.__vy*a,c.rotation=flax.getAngle1(c.__vx,c.__vy,!0)-c.param.angleOffset);var d=flax.getRect(c,!0),e=!1,f=!cc.rectIntersectsRect(this.stageRect,
d);f||(d=this._checkHittedTarget(c,d,!1))&&d.length&&(e=flax.getPosition(c,!0),d=c.param.damageRadius,0<d&&(d=cc.rect(e.x-d/2,e.y-d/2,d,d),this._checkHittedTarget(c,d,!0)),e=!0);f?(this.onBulletOut.dispatch(c),this.destroyBullet(c,b)):e&&(this.onBulletHit.dispatch(c),c.param.alwaysLive||this.destroyBullet(c,b))}},_checkHittedTarget:function(a,b,c){var d=[],e=null;a.targets?e=a.targets:a.targetMap&&(e=a.targetMap.getCoveredTiles1(b,!0));if(!e||!e.length)return d;b=flax.getRotation(a,!0);for(var f=
-1;++f<e.length;)if(target=e[f],!a.owner||!(target==a.owner||flax.isChildOf(a.owner,target)||!0===target.dead||null!=a.owner.camp&&target.camp==a.owner.camp))if(a.__isMovieClip)for(var g=a.children,h=g.length;h--;){var k=g[h];b=flax.getRotation(k,!0);if(k.mainCollider.checkCollision(target.mainCollider)){target.onHit&&(target.dead=target.onHit(a));!1!==target.hurtable&&this._showHitEffect(a,b,a.convertToWorldSpace(k.getPosition()));target.__isBullet&&(k=target.__canvas._bullets.indexOf(target),-1<
k&&target.__canvas._bullets.splice(k,1),target.__body.destroy());if(!c)return[target];d.push(target)}}else if(a.mainCollider.checkCollision(target.mainCollider)){target.onHit&&(target.dead=target.onHit(a));!1!==target.hurtable&&this._showHitEffect(a,b,a.getPosition());target.__isBullet&&(k=target.__canvas._bullets.indexOf(target),-1<k&&target.__canvas._bullets.splice(k,1),target.__body.destroy());if(!c)return[target];d.push(target)}return d},_showHitEffect:function(a,b,c){if(null!=a.param.hitEffectID&&
""!=a.param.hitEffectID){var d=flax.assetsManager.createDisplay(a.param.bulletAssets,a.param.hitEffectID,{parent:this},!0);d.zIndex=999;d.autoDestroyWhenOver=!0;d.setPosition(c||a.getPosition());d.setRotation(b);d.gotoAndPlay(0)}}});flax.BulletCanvas.fetch=function(a){if(flax._bulletCanvases[a])return flax._bulletCanvases[a];var b=cc.path.changeBasename(a,".png"),b=new flax.BulletCanvas(b,100);b.assetsFile=a;return flax._bulletCanvases[a]=b};flax._bulletCanvases={};
flax.BulletCanvas.reset=function(){for(var a in flax._bulletCanvases)flax._bulletCanvases[a].removeFromParent(!0);flax._bulletCanvases={}};flax.Gun.create=function(a){if(null==a)return cc.log("Please give me a param defiled like: flax.GunParam!"),null;a=flax.GunParam.create(a);var b=new flax.Gun;b.param=a;b.init();return b};flax=flax||{};flax.GunnerCamp={player:"Player",enemy:"Enemy"};
flax._gunnerDefine={camp:null,_gunParam:null,targets:null,aimTarget:null,alwaysBind:!0,_guns:null,_autoShooting:!1,_waitingShoot:!1,_auto:!1,onEnter:function(){this._super();this._guns=[];this._gunParam&&this.setGunParam(this._gunParam)},onRecycle:function(){this._super();this.stopShoot()},getGunParam:function(){return this._gunParam},setGunParam:function(a){this._gunParam=a;if(null!=this.parent)if(null==a.gunAnchors)cc.log("Please set the gunAnchors param!");else{for(var b=-1,c=a.gunAnchors.length,
d=null,e=null;++b<c;)d=a.gunAnchors[b],e=flax.Gun.create(this._gunParam),this.bindAnchor(d,e,this.alwaysBind)&&(e.owner=this,e.name=d,this[d]=e,this._guns.push(e));this._waitingShoot&&this.scheduleOnce(this.autoShoot,0.1)}},shoot:function(){this._auto=!1;this.aimTarget&&this._aimToTarget();this._doBeginShoot()},autoShoot:function(a){this._auto=!0;null==this.parent||null==this._guns||0==this._guns.length?this._waitingShoot=!0:(this.aimTarget&&this._aimToTarget(),0<a?this.scheduleOnce(this._doBeginShoot,
a):this._doBeginShoot(),this._autoShooting=!0,this._waitingShoot=!1)},_aimToTarget:function(){if(this.aimTarget){null==this.targets?this.targets=[this.aimTarget]:-1==this.targets.indexOf(this.aimTarget)&&this.targets.push(this.aimTarget);for(var a=-1,b=this._guns.length,c=null;++a<b;)c=this._guns[a],c.aimTarget=this.aimTarget}},_doBeginShoot:function(){for(var a=-1,b=this._guns.length;++a<b;)this._auto?this._guns[a].start():this._guns[a].shootOnce()},stopShoot:function(){this._autoShooting=!1;if(null!=
this._guns&&0!=this._guns.length)for(var a=-1,b=this._guns.length;++a<b;)this._guns[a].end()},upgradeGun:function(a,b){var c=this._deltaGunParam(a);!isNaN(b)&&0<b?this.scheduleOnce(function(){this._deltaGunParam(c)},b):this._deltaGunParam(c)},_deltaGunParam:function(a){if(0!=this._guns.length){var b={},c=0,d;for(d in a)c=this._guns[0].param[d]+a[d],0>=c?delete a[d]:(b[d]=-a[d],a[d]=c);c=this._guns.length;for(d=null;c--;)d=this._guns[c],d.updateParam(a);return b}},_onDie:function(){this.stopShoot();
this.ownerBody?this.ownerBody.destroy():this.destroy()}};flax.Gunner=flax.Animator.extend(flax._gunnerDefine);flax.MCGunner=flax.MovieClip.extend(flax._gunnerDefine);flax.addModule(flax.Gunner,flax.HealthModule,!1);flax.addModule(flax.MCGunner,flax.HealthModule,!1);window._p=flax.Gunner.prototype;_p.gunParam;cc.defineGetterSetter(_p,"gunParam",_p.getGunParam,_p.setGunParam);window._p=flax.MCGunner.prototype;_p.gunParam;cc.defineGetterSetter(_p,"gunParam",_p.getGunParam,_p.setGunParam);delete window._p;
flax.Gunner.create=function(a,b){var c=new flax.Gunner(a,b);c.clsName="flax.Gunner";return c};flax.MCGunner.create=function(a,b){var c=new flax.MCGunner(a,b);c.clsName="flax.MCGunner";return c};flax=flax||{};
flax.ScrollingBG=cc.Node.extend({name:null,source:null,assetID:null,bg0:null,bg1:null,_isTiled:null,_scrolling:!1,_paused:!1,_speedX:0,_speedY:0,_d:1,_size:null,_x0:0,_y0:0,init:function(){if(this._super()){if(null==this.source)return cc.log("Please give a source!"),!1;if(null!=this.assetID)!0!==this._isTiled?(this.bg0=flax.assetsManager.createDisplay(this.source,this.assetID),this.bg1=flax.assetsManager.createDisplay(this.source,this.assetID)):(this.bg0=flax.TiledImage.create(this.source,this.assetID),
this.bg1=flax.TiledImage.create(this.source,this.assetID));else if(this.source)if(this.source instanceof flax.FlaxSprite)this.source.parent&&this.source.parent.addChild(this,this.source.zIndex),this.name=this.source.name,this.parent&&(this.parent[this.name]=this),this.setPosition(this.source.getPosition()),this.bg0=flax.assetsManager.cloneDisplay(this.source),this.bg1=flax.assetsManager.cloneDisplay(this.source),this.source.destroy();else if(flax.isImageFile(this.source))this.bg0=cc.Sprite.create(this.source),
this.bg1=cc.Sprite.create(this.source);else return cc.log("Not support source type!"),!1;else throw"Arguments is not valid!";this.bg0.setAnchorPoint(0,0);this.bg1.setAnchorPoint(0,0);this.addChild(this.bg0);this.addChild(this.bg1);this._size=this.bg0.getContentSize();return!0}return!1},startXScroll:function(a){0==a||this._scrolling||(this._scrolling=!0,this._speedX=a,this._speedY=0,this._d=0<this._speedX?1:-1,this._resetScroll(),this._doScroll())},startYScroll:function(a){0==a||this._scrolling||(this._scrolling=
!0,this._speedY=a,this._speedX=0,this._d=0<this._speedY?1:-1,this._resetScroll(),this._doScroll())},pauseScroll:function(){this._scrolling&&!this._paused&&(this._paused=!0,this.bg0.stopAllActions(),this.bg1.stopAllActions(),this.unscheduleAllCallbacks())},resumeScroll:function(){this._scrolling&&this._paused&&(this._paused=!1,0!=this._speedX?this._doScroll(this._size.width-Math.abs(this.bg0.x)):0!=this._speedY&&this._doScroll(this._size.height-Math.abs(this.bg0.y)))},_resetScroll:function(){this.bg0.setPosition(this._x0,
this._y0);0!=this._speedX?this.bg1.x=-this._d*(this._size.width-1):this.bg1.y=-this._d*(this._size.height-1)},_doScroll:function(a){if(0!==a){var b=0!=this._speedX;null==a&&(a=b?this._size.width:this._size.height);var c=a/Math.abs(b?this._speedX:this._speedY);a*=this._d;this.bg0.runAction(cc.MoveBy.create(c,cc.p(b?a:0,b?0:a)));this.bg1.runAction(cc.MoveBy.create(c,cc.p(b?a:0,b?0:a)));this.scheduleOnce(function(){if(this._scrolling&&!this._paused){var a=this.bg0;this.bg0=this.bg1;this.bg1=a;this._resetScroll();
this._doScroll()}},c)}}});flax.ScrollingBG.create=function(a,b,c){var d=new flax.ScrollingBG;d.source=a;d.assetID=b;d._isTiled=c;return d.init()?d:null};flax=flax||{};
flax._scrollPaneDefine={_viewRect:null,onEnter:function(){this._super();(this._viewRect=this.getCollider("view").getRect(!0))?flax.inputManager.addListener(null,this._startDrag,InputType.press,this):cc.log("If you want me scrollable, please set collider__view for me!")},scrollToCenter:function(a,b){var c=cc.visibleRect.center,c=this.parent.convertToNodeSpace(c),d=this.convertToWorldSpace(a.getPosition?a.getPosition():a),d=this.parent.convertToNodeSpace(d),c=cc.pSub(c,d),c=this._validatePos(this.x+c.x,
this.y+c.y);0<b?this.runAction(cc.MoveTo.create(b,c)):this.setPosition(c)},_startDrag:function(a,b){this.scheduleOnce(function(){flax.inputManager.addListener(null,this._drag,InputType.move,this);flax.inputManager.addListener(null,this._stopDrag,InputType.up,this)},0.01)},_drag:function(a,b){var c=a.getDelta();this._viewRect.width>=this.width&&(c.x=0);this._viewRect.height>=this.height&&(c.y=0);c=this._validatePos(this.x+c.x,this.y+c.y);this.x=c.x;this.y=c.y},_stopDrag:function(a,b){flax.inputManager.removeListener(null,
this._drag,InputType.move);flax.inputManager.removeListener(null,this._stopDrag,InputType.up)},_validatePos:function(a,b){a=Math.max(this._viewRect.x+this._viewRect.width-this.width,a);a=Math.min(this._viewRect.x,a);b=Math.max(this._viewRect.y+this._viewRect.height-this.height,b);b=Math.min(this._viewRect.y,b);return cc.p(a,b)}};flax.ScrollPane=flax.MovieClip.extend(flax._scrollPaneDefine);flax.ScrollPane.create=function(a,b){return new flax.ScrollPane(a,b)};flax.ScrollPane1=flax.Animator.extend(flax._scrollPaneDefine);
flax.ScrollPane1.create=function(a,b){return new flax.ScrollPane1(a,b)};flax=flax||{};
flax.TiledImage=cc.SpriteBatchNode.extend({tileMap:null,tileWidthOffset:-1,tileHeightOffset:-1,_assetsFile:null,_taID:null,_minWidth:0,_minHeight:0,_pool:null,init:function(a,b){this._super(a,b);this.tileMap=flax.TileMap.create("tile_image_"+flax.randInt(0,1E3));return!0},setTileSource:function(a,b){if(this._assetsFile!=a||this._taID!=b){this._assetsFile=a;this._taID=b;this._pool=flax.ObjectPool.get(a,"flax.Animator");var c=flax.assetsManager.createDisplay(this._assetsFile,this._taID).getContentSize();this.tileMap.setTileSize(c.width+
this.tileWidthOffset,c.height+this.tileHeightOffset);0<this._minWidth*this._minHeight&&(0<this._children.length?this._updateTileImg():this._updateSize())}},setMinSize:function(a,b){0!=(a-this._minWidth)*(b-this._minHeight)&&(this._minWidth=a,this._minHeight=b,this._assetsFile&&this._updateSize())},_updateTileImg:function(){for(var a=null,b=this._children.length,c=-1;++c<b;)a=this._children[c],a.setSource(this._assetsFile,this._taID)},_updateSize:function(){var a=this.tileMap.setMapSizePixel(this._minWidth,
this._minHeight),b,c=a[0].length;if(0<c){var d;for(b=-1;++b<c;)d=a[0][b],d.destroy()}c=a[1].length;if(0<c)for(b=-1;++b<c;)this._createTile(a[1][b][0],a[1][b][1]);this.setContentSize(this.tileMap.getPixelSize())},_createTile:function(a,b){var c=this._pool.fetch(this._taID,this);c.setAnchorPoint(0.5,0.5);this.tileMap.addObject(c,a,b);this.tileMap.snapToTile(c,a,b);return c}});
flax.TiledImage.create=function(a,b,c,d){var e=new flax.TiledImage,f=cc.path.changeBasename(a,".png");return e.init(f,10)?(e.setTileSource(a,b),isNaN(c)||(c=cc.visibleRect.width),isNaN(d)||(d=cc.visibleRect.height),e.setMinSize(c,d),e):null};var LinkFinder={map:null,blocks:null,findLink:function(a,b,c,d){var e=null,e=a==c||b==d?LinkFinder._checkDirectLink(a,b,c,d):LinkFinder._checkOneLink(a,b,c,d);null==e&&(e=LinkFinder._checkTwoLink(a,b,c,d));return e},shuffle:function(a){var b=this.map.getAllObjects(),c=b.concat(),d=-1;if(this.blocks&&this.blocks.length)for(c=[];++d<b.length;){var e=b[d];-1==this.blocks.indexOf(e)&&c.push(e)}c.shuffle();d=-1;for(b=c.length/2;++d<b;){var e=c[d],f=c[d+b],g=cc.p(e.getPosition());!1!==a?(e.runAction(cc.MoveTo.create(0.2,
f.getPosition())),f.runAction(cc.MoveTo.create(0.2,g))):(e.setPosition(f.getPosition()),f.setPosition(g))}},findAvailableLink:function(a){var b=this.map.getAllObjects(),c=b.length;if(0==c)return null;for(var d,e,f=null,g=[],h=null,k=0;k<c-1;k++)if(d=b[k],!(this.blocks&&-1<this.blocks.indexOf(d))){var m=0==g.length;null==h&&(h=d);for(var l=k+1;l<c;l++)if(e=b[l],!(this.blocks&&-1<this.blocks.indexOf(e)))if(e.assetID==d.assetID){if(LinkFinder.findLink(d.tx,d.ty,e.tx,e.ty))return[d,e];m&&g.push(e)}else m&&
null==f&&LinkFinder.findLink(d.tx,d.ty,e.tx,e.ty)&&(f=e)}if(0==g.length)return null;b=g[Math.floor(g.length*Math.random())];c=cc.p(b.getPosition());if(null==f){f=this._findEmptyNeighbor(h.tx,h.ty);if(null==f)throw"Dead map!!!!";c=this.map.getTiledPosition(f.x,f.y);b.parent&&(c=b.parent.convertToNodeSpace(c));!0===a?b.runAction(cc.MoveTo.create(0.2,c)):b.setPosition(c)}else!0===a?(b.runAction(cc.MoveTo.create(0.2,f.getPosition())),f.runAction(cc.MoveTo.create(0.2,c))):(b.setPosition(f.getPosition()),
f.setPosition(c));return[h,b]},_findEmptyNeighbor:function(a,b){for(var c=null,d=0;4>d&&(c=EIGHT_DIRECT_VALUE[d],c=cc.p(a+c[0],b+c[1]),!this.map.isEmptyTile(c.x,c.y));d++);return c},_checkDirectLink:function(a,b,c,d){if(a==c&&b==d)return null;if(a==c){for(var e=!0,f=0<d-b?1:-1,g=b+f;g!=d;){if(!this.map.isEmptyTile(a,g)){e=!1;break}g+=f}if(e)return[new cc.p(a,b),new cc.p(c,d)]}if(b==d){e=!0;f=0<c-a?1:-1;for(g=a+f;g!=c;){if(!this.map.isEmptyTile(g,b)){e=!1;break}g+=f}if(e)return[new cc.p(a,b),new cc.p(c,
d)]}return null},_checkOneLink:function(a,b,c,d){if(a==c||b==d)return null;if(this.map.isEmptyTile(a,d)){var e=LinkFinder._checkDirectLink(a,b,a,d);if(e&&(e=LinkFinder._checkDirectLink(a,d,c,d)))return[new cc.p(a,b),new cc.p(a,d),new cc.p(c,d)]}return this.map.isEmptyTile(c,b)&&(e=LinkFinder._checkDirectLink(a,b,c,b))&&(e=LinkFinder._checkDirectLink(c,b,c,d))?[new cc.p(a,b),new cc.p(c,b),new cc.p(c,d)]:null},_checkTwoLink:function(a,b,c,d){if(a==c&&b==d)return null;var e=0<=c-a?1:-1,f=0<=d-b?1:-1,
g=LinkFinder._twoLinkSearch(a,b,c,d,e,f);null==g&&(g=LinkFinder._twoLinkSearch(a,b,c,d,-e,-f));null!=g&&g.unshift(new cc.p(a,b));return g},_twoLinkSearch:function(a,b,c,d,e,f){for(var g=null,h=a+e,k=b+f,m=!1,l=!1;!m||!l;){if(!m&&(m=!this.map.isEmptyTile(h,b),!m)){g=LinkFinder._checkOneLink(h,b,c,d);if(null!=g)break;h+=e}if(!l&&(l=!this.map.isEmptyTile(a,k),!l)){g=LinkFinder._checkOneLink(a,k,c,d);if(null!=g)break;k+=f}}return g}};flax=flax||{};flax.HealthModule={maxHealth:100,health:100,hurtable:!0,dead:!1,ownerBody:null,onEnter:function(){this.health=this.maxHealth;this.dead=!1},onExit:function(){},onHit:function(a){if(!this.hurtable)return!1;if(this.dead)return!0;this.health-=a.damage;return 0>=this.health?(this.dead=!0,this.health=0,this._onDie(),!0):!1},_onDie:function(){this.ownerBody?this.ownerBody.destroy():this.destroy()}};flax=flax||{};
flax.EnemyWaveModule={waveAssetJson:null,waves:null,onWaveBegin:null,onEnemyIn:null,onWaveOver:null,batchCanvas:null,currentWave:-1,totalWaves:0,wavePaused:!0,waveOver:!1,_waveDefine:null,_enemyCount:0,_firstRun:!0,onEnter:function(){this.totalWaves=this.waves.length;this.onWaveBegin=new signals.Signal;this.onEnemyIn=new signals.Signal;this.onWaveOver=new signals.Signal;this.wavePaused||this.nextWave()},onExit:function(){this.onWaveBegin.removeAll();this.onEnemyIn.removeAll();this.onWaveOver.removeAll()},startWave:function(){this.wavePaused&&
(this.wavePaused=!1,this._firstRun?this.nextWave():this._createWaveEnemy(),this._firstRun=!1)},stopWave:function(){this.wavePaused||(this.wavePaused=!0)},nextWave:function(){this.waveOver||this.wavePaused||(this._enemyCount=0,this.currentWave++,this._waveDefine=this.waves[this.currentWave],this._createWaveEnemy(),this.onWaveBegin.dispatch())},_createWaveEnemy:function(){if(!this.waveOver&&!this.wavePaused){var a=flax.getRandomInArray(this._waveDefine.types),a=this._doCreateEnemy(a);this.onEnemyIn.dispatch(a);
++this._enemyCount<this._waveDefine.count?(a=flax.randInt(parseInt(this._waveDefine.interval[0]),parseInt(this._waveDefine.interval[1])),this.scheduleOnce(function(){this._createWaveEnemy()},a)):this.currentWave==this.totalWaves-1?(this.waveOver=!0,this.onWaveOver.dispatch()):this.nextWave()}},_doCreateEnemy:function(a){this.waveAssetJson&&flax.assetsManager.createDisplay(this.waveAssetJson,a,{parent:this.batchCanvas,x:this.x,y:this.y},!0)}};